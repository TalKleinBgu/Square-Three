<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Square-Three Game</title>
    <style>
         /* ==========================================
           GAME BOARD COMPLETION
           ========================================== */
        .cell {
            width: min(18vw, 15vh, 90px);       /* Uses smallest dimension */
            height: min(18vw, 15vh, 90px);      /* Keeps cells square */
            max-width: 90px;
            max-height: 90px;
            min-width: 45px;                    /* Smaller minimum for portrait */
            min-height: 45px;
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 16px;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            font-size: clamp(1rem, min(4vw, 3vh), 2rem);  /* Responsive to both dimensions */
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            text-align: center !important;
            line-height: 1 !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        /* Remove this entire rule */
        .cell.X, .cell.O {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Remove this entire rule */
        .cell.X::before, .cell.O::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .cell:hover:not(.blocked):not(.X):not(.O) {
            background: rgba(255, 255, 255, 0.6); 
            transform: translateY(-2px);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .cell:active {
            transform: translateY(0) scale(0.98);
            transition: all 0.1s ease;
        }

        .cell.blocked {
            background: rgba(255, 200, 200, 0.4);
            border-color: rgba(255, 100, 100, 0.6);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .cell.blocked::after {
            content: '🚫';
            position: absolute;
            font-size: 1rem;
            top: 4px;
            right: 4px;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }
        /* Add to your existing CSS */
        .cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .board {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.6);
        }

        .cell {
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .cell.last-move {
            position: relative;
            overflow: visible;
            box-shadow: 
                0 0 0 3px rgba(74, 144, 226, 0.6),      /* Changed from rgba(102, 126, 234, 0.6) */
                0 0 20px rgba(74, 144, 226, 0.3),       /* Changed from rgba(102, 126, 234, 0.3) */
                0 12px 32px rgba(0, 0, 0, 0.2);
            border-color: rgba(74, 144, 226, 0.4);     /* Changed from rgba(102, 126, 234, 0.4) */
            animation: lastMoveGlow 2s ease-in-out infinite alternate;
        }
/* 
        .cell.last-move::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            background: conic-gradient(
                from 0deg,
                rgba(74, 144, 226, 0.8),     
                rgba(90, 103, 216, 0.8),    
                rgba(74, 144, 226, 0.8)     
            );
            border-radius: 20px;
            animation: lastMoveRotate 3s linear infinite;
            z-index: -1;
        } */

        @keyframes lastMoveGlow {
            0% { 
                box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.6), 0 0 20px rgba(74, 144, 226, 0.3); 
            }
            100% { 
                box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.6), 0 0 25px rgba(90, 103, 216, 0.4); 
            }
        }

        @keyframes lastMoveRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Enhanced Player Symbols - Fix animation trigger */
        .X {
            color: #FF6B6B;
            text-shadow: 
                0 2px 8px rgba(255, 107, 107, 0.4),
                0 0 20px rgba(255, 107, 107, 0.3);
            position: relative;
            z-index: 2;
        }

        .O {
            color: #4ECDC4;
            text-shadow: 
                0 2px 8px rgba(78, 205, 196, 0.4),
                0 0 20px rgba(78, 205, 196, 0.3);
            position: relative;
            z-index: 2;
        }

        /* Only animate when symbol is first added */
        .cell.just-played {
            animation: symbolEntry 0.15s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes symbolEntry {
            0% {
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }
            60% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes symbolPulse {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ==========================================
           GAME STATUS & INFORMATION
           ========================================== */
        .game-status {
            text-align: center;
            margin-top: 32px;
            font-size: 1.4rem;
            font-weight: 600;
            min-height: 40px;
            color: rgba(0, 0, 0, 0.9);
            position: relative;
            z-index: 1;
        }

        .winner {
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 1.6rem;
            animation: winnerCelebration 2s ease-in-out infinite;
            text-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
            display: inline-block;
            overflow: visible;
        }

        .winner::before {
            content: '🎉';
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            animation: celebrationBounce 1s ease-in-out infinite alternate;
        }

        .winner::after {
            content: '🎉';
            position: absolute;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            animation: celebrationBounce 1s ease-in-out infinite alternate-reverse;
        }

        @keyframes winnerCelebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(1deg); }
            75% { transform: scale(1.05) rotate(-1deg); }
        }

        @keyframes celebrationBounce {
            0% { transform: translateY(-50%) scale(1) rotate(0deg); }
            100% { transform: translateY(-70%) scale(1.2) rotate(15deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .rules {
            margin-top: 36px;
            background: rgba(255, 255, 255, 0.4);
            padding: 28px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .rules::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(
                circle at center,
                rgba(102, 126, 234, 0.05) 0%,
                transparent 70%
            );
            animation: rulesGlow 8s ease-in-out infinite alternate;
            pointer-events: none;
        }

        @keyframes rulesGlow {
            0% { transform: rotate(0deg) scale(1); opacity: 0.3; }
            100% { transform: rotate(180deg) scale(1.2); opacity: 0.7; }
        }

        .rules h3 {
            margin-bottom: 16px;
            color: rgba(0, 0, 0, 0.9);
            font-weight: 700;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rules ul {
            list-style: none;
            line-height: 1.8;
            color: rgba(0, 0, 0, 0.8);
        }

        .rules li {
            position: relative;
            padding-left: 24px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 8px 0;
            margin: 0 -12px;
            padding-left: 36px;
        }

        .rules li:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(8px);
            padding-left: 44px;
        }

        .rules li::before {
            content: '✨';
            position: absolute;
            left: 0;
            top: 0;
            font-size: 14px;
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .rules li:hover::before {
            transform: scale(1.2) rotate(15deg);
        }

        /* ==========================================
           STATISTICS TABLES
           ========================================== */

        /* Enhanced Matrix Table */
        .matrix-table-enhanced {
            display: grid;
            grid-template-columns: auto repeat(5, 1fr);
            gap: 8px;
            font-size: 13px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .matrix-table-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 49%, rgba(255, 255, 255, 0.03) 50%, transparent 51%);
            pointer-events: none;
        }

        /* Matrix Title Section */
        .matrix-title-section {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 16px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 100%);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .matrix-title-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: rotate-gradient 10s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate-gradient {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .matrix-main-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .title-icon {
            font-size: 24px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            animation: gentle-pulse 3s ease-in-out infinite;
        }

        @keyframes gentle-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .matrix-main-title h3 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .matrix-subtitle {
            position: relative;
            z-index: 1;
        }

        /* Fixed axis explanation alignment */
        .axis-explanation-fixed {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 8px;
            flex-wrap: nowrap;
        }

        .x-player-indicator-fixed, .o-player-indicator-fixed {
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            border: 2px solid;
            backdrop-filter: blur(5px);
            white-space: nowrap;
            min-width: 200px;
            text-align: center;
        }

        .x-player-indicator-fixed {
            background: linear-gradient(135deg, rgba(255, 59, 48, 0.2), rgba(255, 59, 48, 0.1));
            border-color: rgba(255, 59, 48, 0.4);
            color: #FF3B30;
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.2);
        }

        .o-player-indicator-fixed {
            background: linear-gradient(135deg, rgba(52, 199, 89, 0.2), rgba(52, 199, 89, 0.1));
            border-color: rgba(52, 199, 89, 0.4);
            color: #34C759;
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.2);
        }

        .vs-divider {
            font-size: 16px;
            font-weight: 700;
            color: rgba(0, 0, 0, 0.6);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .reading-guide {
            font-size: 12px;
            color: rgba(0, 0, 0, 0.7);
            font-style: italic;
        }

        /* Matrix Headers and Cells */
        .matrix-corner-header {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.2) 100%);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .corner-content {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .corner-x {
            color: #FF3B30;
            font-weight: 700;
        }

        .corner-o {
            color: #34C759;
            font-weight: 700;
        }

        .corner-divider {
            color: rgba(0, 0, 0, 0.5);
            font-weight: 700;
            font-size: 16px;
        }

        .matrix-header-enhanced {
            padding: 12px 8px;
            border-radius: 12px;
            border: 2px solid;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .matrix-header-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            pointer-events: none;
        }

        .matrix-header-enhanced:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .strategy-header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            position: relative;
            z-index: 1;
        }

        .strategy-player-icon {
            font-size: 18px;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        }

        .strategy-icon {
            font-size: 20px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .strategy-header-text {
            text-align: center;
        }

        .strategy-header-name {
            display: block;
            font-weight: 700;
            font-size: 12px;
            letter-spacing: -0.01em;
        }

        .strategy-header-role {
            display: block;
            font-size: 9px;
            color: rgba(0, 0, 0, 0.6);
            font-weight: 500;
            margin-top: 2px;
        }

        /* Clean matrix cells without background colors */
        .matrix-cell-enhanced-clean {
            padding: 12px 8px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-left-width: 3px;
            border-top-width: 3px;
            background: rgba(255, 255, 255, 0.05); /* Very subtle background */
            backdrop-filter: blur(5px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: help;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .matrix-cell-enhanced-clean::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            pointer-events: none;
        }

        .matrix-cell-enhanced-clean:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 10;
            background: rgba(255, 255, 255, 0.1);
        }

        .no-data {
            background: linear-gradient(135deg, rgba(128, 128, 128, 0.1) 0%, rgba(128, 128, 128, 0.05) 100%);
            border-color: rgba(128, 128, 128, 0.2);
            opacity: 0.6;
        }

        .no-data-icon {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .no-data-text {
            font-size: 10px;
            color: rgba(0, 0, 0, 0.5);
            font-style: italic;
        }

        /* Cell content styling */
        .cell-performance {
            display: flex;
            align-items: center;
            gap: 4px;
            position: relative;
            z-index: 1;
        }

        .performance-indicator {
            font-size: 16px;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        }

        .performance-label {
            font-size: 9px;
            font-weight: 600;
            letter-spacing: 0.02em;
            color: rgba(0, 0, 0, 0.7);
        }

        .cell-winrate {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            position: relative;
            z-index: 1;
        }

        .winrate-main {
            font-weight: 900;
            font-size: 16px;
            color: rgba(0, 0, 0, 0.9);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .winrate-bar {
            width: 40px;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .winrate-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .cell-details {
            display: flex;
            gap: 6px;
            font-size: 9px;
            position: relative;
            z-index: 1;
        }

        .wins-count, .games-total {
            padding: 2px 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            font-weight: 500;
        }

        /* Matrix Legend */
        .matrix-legend {
            grid-column: 1 / -1;
            margin-top: 20px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .matrix-legend h4 {
            margin: 0 0 12px 0;
            text-align: center;
            color: rgba(0, 0, 0, 0.8);
            font-size: 16px;
            font-weight: 600;
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            color: rgba(0, 0, 0, 0.7);
            transition: background 0.2s ease;
        }

        .legend-item:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .legend-icon {
            font-size: 14px;
        }

        /* ==========================================
           STRATEGY RANKINGS
           ========================================== */
        .ranking-item.enhanced {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .ranking-item.enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            pointer-events: none;
        }

        .ranking-item.enhanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.25);
        }

        .ranking-item.excellent {
            background: linear-gradient(135deg, rgba(52, 199, 89, 0.15), rgba(52, 199, 89, 0.05));
            border-color: rgba(52, 199, 89, 0.3);
        }

        .ranking-item.good {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.15), rgba(0, 122, 255, 0.05));
            border-color: rgba(0, 122, 255, 0.3);
        }

        .ranking-item.average {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 193, 7, 0.05));
            border-color: rgba(255, 193, 7, 0.3);
        }

        .ranking-item.poor {
            background: linear-gradient(135deg, rgba(255, 59, 48, 0.15), rgba(255, 59, 48, 0.05));
            border-color: rgba(255, 59, 48, 0.3);
        }

        .ranking-left {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }

        .ranking-medal {
            font-size: 20px;
            animation: gentle-bounce 2s infinite;
        }

        @keyframes gentle-bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-3px); }
            60% { transform: translateY(-2px); }
        }

        .ranking-position {
            font-weight: 700;
            font-size: 18px;
            color: rgba(0, 0, 0, 0.8);
            min-width: 40px;
        }

        .strategy-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .strategy-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .strategy-name {
            font-weight: 600;
            font-size: 16px;
            letter-spacing: -0.01em;
        }

        .strategy-type {
            font-size: 12px;
            color: rgba(0, 0, 0, 0.6);
            font-style: italic;
        }

        .ranking-stats-enhanced {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            min-width: 200px;
        }

        .win-rate-bar {
            position: relative;
            width: 120px;
            height: 24px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .win-rate-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .win-rate-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 600;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.9);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .detailed-stats {
            display: flex;
            gap: 8px;
            font-size: 11px;
        }

        .stat-item, .stat-total {
            padding: 4px 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            font-weight: 500;
        }

        .stat-item.wins { color: #34C759; }
        .stat-item.losses { color: #FF3B30; }
        .stat-item.draws { color: #FF9500; }
        .stat-total { color: rgba(0, 0, 0, 0.7); }

        /* ==========================================
           DETAILED RESULTS
           ========================================== */
        .detail-header-enhanced {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1.2fr;
            gap: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2));
            border-radius: 12px;
            font-weight: 700;
            color: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            align-items: center;
        }

        .detail-col-matchup { 
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-col-stat { 
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 600;
        }

        .strategy-section-header {
            padding: 12px 16px;
            margin: 16px 0 8px 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
            border-radius: 10px;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
            border-left-width: 4px;
            border-left-style: solid;
        }

        .section-icon {
            font-size: 18px;
        }

        .detail-item-enhanced {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1.2fr;
            gap: 12px;
            padding: 14px 20px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .detail-item-enhanced:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .performance-excellent {
            border-left-color: #34C759;
            background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(52, 199, 89, 0.05));
        }

        .performance-good {
            border-left-color: #007AFF;
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(0, 122, 255, 0.05));
        }

        .performance-average {
            border-left-color: #FF9500;
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.1), rgba(255, 149, 0, 0.05));
        }

        .performance-poor {
            border-left-color: #FF3B30;
            background: linear-gradient(135deg, rgba(255, 59, 48, 0.1), rgba(255, 59, 48, 0.05));
        }

        .performance-neutral {
            border-left-color: rgba(0, 0, 0, 0.2);
        }

        .matchup-visual {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .player-x, .player-o {
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .vs-text {
            font-size: 11px;
            color: rgba(0, 0, 0, 0.5);
            font-weight: 500;
            padding: 0 4px;
        }

        .stat-wins { color: #34C759; font-weight: 600; }
        .stat-losses { color: #FF3B30; font-weight: 600; }
        .stat-draws { color: #FF9500; font-weight: 600; }

        .stat-winrate {
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }

        .performance-icon {
            font-size: 14px;
        }

        .winrate-value {
            font-weight: 700;
            font-size: 14px;
        }

        .mini-bar {
            width: 30px;
            height: 6px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .mini-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #34C759, #007AFF);
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        /* Enhanced Section Headers */
        .enhanced-section-header {
            text-align: center;
            margin: 32px 0 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            position: relative;
            overflow: hidden;
        }

        .enhanced-section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(240, 147, 251, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .enhanced-section-header:hover::before {
            opacity: 1;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            letter-spacing: -0.02em;
            position: relative;
            z-index: 1;
            text-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .section-subtitle {
            font-size: 1rem;
            color: rgba(0, 0, 0, 0.7);
            margin-top: 8px;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        /* Statistics containers with enhanced headers */
        #strategyRankings, #matchupMatrix, #detailedResults {
            margin-bottom: 24px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            padding: 24px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            position: relative;
        }

        /* Remove old yellow headers and replace with enhanced ones */
        #strategyRankings h4, 
        #matchupMatrix h4, 
        #detailedResults h4 {
            display: none; /* Hide old headers */
        }

        /* Add new enhanced headers via CSS */
        #strategyRankings::before {
            content: '🏆 Strategy Rankings';
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 20px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            letter-spacing: -0.01em;
        }

        #matchupMatrix::before {
            content: '⚔️ Head-to-Head Matrix';
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 20px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            letter-spacing: -0.01em;
        }

        #detailedResults::before {
            content: '📊 Detailed Results';
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 20px;
            padding: 16px;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            letter-spacing: -0.01em;
        }

        /* Main statistics header */
        #fullStatisticsResults h3 {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 32px;
            letter-spacing: -0.03em;
            text-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            position: relative;
        }

        #fullStatisticsResults h3::before {
            content: '📈';
            position: absolute;
            left: -50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            animation: statsPulse 2s ease-in-out infinite alternate;
        }

        #fullStatisticsResults h3::after {
            content: '🎯';
            position: absolute;
            right: -50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            animation: statsPulse 2s ease-in-out infinite alternate-reverse;
        }

        @keyframes statsPulse {
            0% { transform: translateY(-50%) scale(1); }
            100% { transform: translateY(-60%) scale(1.1); }
        }

        /* ==========================================
           LEGACY/FALLBACK STYLES
           ========================================== */
        .matrix-table {
            display: grid;
            grid-template-columns: auto repeat(5, 1fr);
            gap: 6px;
            font-size: 13px;
        }

        .matrix-header {
            background: rgba(255, 255, 255, 0.3);
            padding: 10px 6px;
            text-align: center;
            border-radius: 8px;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.8);
            line-height: 1.2;
        }

        .matrix-header small {
            font-size: 10px;
            color: rgba(0, 0, 0, 0.6);
            font-weight: 400;
        }

        .matrix-cell {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 4px;
            text-align: center;
            border-radius: 8px;
            color: rgba(0, 0, 0, 0.7);
            cursor: help;
            transition: background-color 0.2s ease;
            line-height: 1.1;
        }

        .matrix-cell:hover {
            background: rgba(255, 255, 255, 0.35);
        }

        .matrix-cell small {
            font-size: 10px;
            color: rgba(0, 0, 0, 0.5);
        }

        .matrix-cell.win {
            background: rgba(52, 199, 89, 0.25);
        }

        .matrix-cell.loss {
            background: rgba(255, 59, 48, 0.25);
        }

        .matrix-cell.draw {
            background: rgba(255, 193, 7, 0.25);
        }

        /* ==========================================
           INTERACTIVE ENHANCEMENTS
           ========================================== */
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        .cell-highlight {
            animation: cellHighlight 0.6s ease-out;
        }

        @keyframes cellHighlight {
            0% { 
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
                transform: scale(1);
            }
            70% { 
                box-shadow: 0 0 0 10px rgba(102, 126, 234, 0);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
                transform: scale(1);
            }
        }

        .mode-transition {
            animation: modeTransition 0.5s ease-out;
        }

        @keyframes modeTransition {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .winner-fireworks {
            position: relative;
            overflow: visible;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: firework 1s ease-out forwards;
        }

        @keyframes firework {
            0% {
                opacity: 1;
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1) translate(var(--dx), var(--dy));
            }
        }

        .floating-symbol {
            position: absolute;
            pointer-events: none;
            font-size: 2rem;
            font-weight: bold;
            opacity: 0;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }

        @keyframes thinkingPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .thinking-dots {
            margin-left: 5px;
            font-weight: bold;
        }

        /* ==========================================
           RESPONSIVE DESIGN
           ========================================== */
        /* @media (max-width: 768px) {
            .game-container {
                padding: 28px;
                border-radius: 24px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .cell {
                width: 65px;
                height: 65px;
                font-size: 1.8rem;
            }
            
            .board {
                max-width: 320px;
                gap: 10px;
                padding: 16px;
            }
            
            .cell:hover {
                transform: translateY(-4px) scale(1.02);
            }
            
            .winner::before,
            .winner::after {
                font-size: 1.2rem;
            }
            
            .ranking-item.enhanced {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                padding: 16px;
            }
            
            .ranking-left {
                justify-content: center;
            }
            
            .ranking-stats-enhanced {
                align-items: center;
                min-width: auto;
            }
            
            .detailed-stats {
                justify-content: center;
            }
            
            .detail-header-enhanced,
            .detail-item-enhanced {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 8px;
            }
            
            .matchup-visual {
                justify-content: center;
            }
            
            .strategy-section-header {
                justify-content: center;
                text-align: center;
            }
            
            .matrix-table-enhanced {
                grid-template-columns: auto repeat(5, 1fr);
                gap: 6px;
                font-size: 11px;
                padding: 15px;
            }
            
            .matrix-main-title h3 {
                font-size: 18px;
            }
            
            .axis-explanation-fixed {
                flex-direction: column;
                gap: 12px;
            }
            
            .x-player-indicator-fixed, .o-player-indicator-fixed {
                min-width: auto;
                padding: 10px 20px;
                font-size: 13px;
            }
            
            .strategy-header-name {
                font-size: 10px;
            }
            
            .strategy-header-role {
                font-size: 8px;
            }
            
            .winrate-main {
                font-size: 12px;
            }
            
            .legend-items {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 6px;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            #strategyRankings::before,
            #matchupMatrix::before,
            #detailedResults::before {
                font-size: 1.3rem;
            }
            
            #fullStatisticsResults h3 {
                font-size: 1.8rem;
            }
            
            #fullStatisticsResults h3::before,
            #fullStatisticsResults h3::after {
                display: none; /* Hide side icons on mobile */
            /* }
        } */

        /* @media (max-width: 480px) {
            .game-container {
                margin: 12px;
                padding: 24px;
                border-radius: 20px;
            }
            
            .cell {
                width: 60px;
                height: 60px;
                font-size: 1.6rem;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .board {
                max-width: 280px;
                gap: 8px;
                padding: 12px;
            }
            
            .game-container::after {
                animation-duration: 30s;
            }
            
            .cell.last-move::before {
                top: -4px;
                left: -4px;
                right: -4px;
                bottom: -4px;
            }
            
            .rules li:hover {
                transform: translateX(4px);
            }
            
            .strategy-icon {
                font-size: 20px;
            }
            
            .strategy-name {
                font-size: 14px;
            }
            
            .win-rate-bar {
                width: 100px;
                height: 20px;
            }
            
            .detailed-stats {
                flex-wrap: wrap;
                gap: 4px;
            }
            
            .matrix-table-enhanced {
                gap: 4px;
                font-size: 10px;
                padding: 12px;
            }
            
            .matrix-cell-enhanced-clean {
                padding: 8px 4px;
                gap: 4px;
            }
            
            .performance-label {
                display: none;
            }
            
            .cell-details {
                font-size: 8px;
                gap: 4px;
            }
            
            .legend-items {
                grid-template-columns: 1fr;
            }
            
            .enhanced-section-header {
                padding: 16px;
                margin: 24px 0 16px 0;
            }
            
            .ai-vs-ai-settings {
                grid-template-columns: 1fr;
            }
        } */ 

        /* ==========================================
           RESET & BASE STYLES
           ========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f0f5 0%, #e8e8ed 50%, #f5f5fa 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(0, 0, 0, 0.87);
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    
/* Better portrait phone support - REPLACE your existing mobile CSS with this */
        /* Better portrait phone support - REPLACE your existing mobile CSS with this */
        @media (max-width: 480px) and (orientation: portrait) {
            body {
                padding: 5px;
            }
            
            .game-container {
                padding: 10px;
                margin: 5px;
                border-radius: 15px;
                max-width: 100%;
                overflow-x: hidden;
            }
            
            h1 {
                font-size: 1.6rem;
                margin-bottom: 12px;
                line-height: 1.1;
            }
            
            /* FIXED: Stack game modes vertically (not horizontally) */
            .game-mode {
                display: flex;
                flex-direction: column;  /* Changed from row to column */
                gap: 10px;              /* Bigger gap for better spacing */
                padding: 12px 8px;
                margin-bottom: 15px;
            }
            
            .mode-btn {
                width: 100%;            /* Full width buttons */
                padding: 12px 16px;     /* More padding for easier tapping */
                font-size: 13px;
                border-radius: 12px;
                text-align: center;
            }
            
            /* IMPROVED: Bigger board for better gameplay */
            .board {
                width: 85vw;              /* Bigger width - use more screen */
                max-width: 280px;         /* Bigger max-width */
                gap: 1.2vw;               /* More gap between cells */
                padding: 2vw;             /* More padding */
                margin: 15px auto;        /* Center the board */
                border-radius: 15px;
                box-sizing: border-box;   
                display: grid;
                grid-template-columns: repeat(4, 1fr);  
                justify-items: center;    
                align-items: center;      
            }
            
            .cell {
                width: 18vw;              /* Bigger cells */
                height: 18vw;
                max-width: 60px;          /* Bigger max size */
                max-height: 60px;
                min-width: 45px;          /* Bigger minimum */
                min-height: 45px;
                font-size: 1.2rem;        /* Bigger font for X/O */
                border-radius: 10px;
                border-width: 2px;        /* Thicker borders */
                box-sizing: border-box;   
            }
            
            /* FIXED: Align Hot Adjacency Blocking toggle */
            .hot-adjacency-container {
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
                gap: 10px !important;
                padding: 10px !important;
                margin: 10px 0 !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            .hot-adjacency-container label {
                flex: 1 !important;
                font-size: 14px !important;
                line-height: 1.2 !important;
                margin: 0 !important;
                padding: 0 !important;
                vertical-align: middle !important;
            }

            
            .toggle-switch {
                flex-shrink: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
                vertical-align: middle !important;
                align-self: center !important;
            }
            
            /* Compact controls */
            .game-info {
                flex-direction: column;
                gap: 8px;
                text-align: center;
                padding: 8px;
            }
            
            .current-player {
                font-size: 0.9rem;
            }
            
            .reset-btn, .stats-btn {
                padding: 8px 15px;
                font-size: 12px;
                margin: 2px;
                border-radius: 12px;
            }
            
            /* Compact AI settings */
            .ai-settings {
                font-size: 13px;
            }
            
            .ai-vs-ai-settings {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .ai-config {
                padding: 10px;
            }
            
            .depth-control {
                padding: 10px;
                margin-bottom: 15px;
                font-size: 13px;
            }
            
            .difficulty-select, .eval-select {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            /* FIXED: Bigger and better rules/instructions */
            .rules {
                margin-top: 20px;
                padding: 18px;            /* More padding */
                border-radius: 15px;      /* Bigger border radius */
                background: rgba(255, 255, 255, 0.9);  /* More visible background */
                border: 2px solid rgba(74, 144, 226, 0.3);  /* Add border */
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);   /* Add shadow */
            }
            
            .rules h3 {
                font-size: 1.4rem;        /* Much bigger title */
                margin-bottom: 15px;      /* More space below title */
                color: #2c5aa0;           /* Blue color for title */
                font-weight: 700;         /* Bold title */
                text-align: center;       /* Center the title */
            }
            
            .rules li {
                font-size: 14px;          /* Bigger text */
                line-height: 1.6;         /* Better line spacing */
                margin-bottom: 8px;       /* More space between items */
                padding-left: 25px;       /* More left padding */
                color: #333;              /* Darker text for readability */
                font-weight: 500;         /* Slightly bold text */
            }
            
            .rules ul {
                padding-left: 0;          /* Remove default padding */
                margin: 0;                /* Remove default margin */
            }
            
            /* Statistics in portrait - simplified */
            #strategyRankings, #matchupMatrix, #detailedResults {
                padding: 8px;
                margin-bottom: 12px;
                font-size: 11px;
            }
            
            #strategyRankings::before,
            #matchupMatrix::before,
            #detailedResults::before {
                font-size: 1rem;
                padding: 8px;
                margin-bottom: 10px;
            }
            
            /* Hide complex tables on portrait, show simplified message */
            #matchupMatrix .matrix-table-enhanced,
            #detailedResults .detail-header-enhanced,
            #detailedResults .detail-item-enhanced,
            #detailedResults .strategy-section-header {
                display: none;
            }
            
            /* FIXED: Bigger, more readable rotation message */
            #matchupMatrix::after,
            #detailedResults::after {
                content: "📱➡️ Rotate to landscape view for detailed statistics 📊";
                display: block;
                text-align: center;
                padding: 20px 15px;     /* More padding */
                background: rgba(74, 144, 226, 0.15);  /* Better background color */
                border: 2px dashed rgba(74, 144, 226, 0.4);  /* Border for visibility */
                border-radius: 12px;    /* Bigger border radius */
                font-style: italic;
                color: #2c5aa0;         /* Darker, more readable color */
                font-size: 15px;        /* Bigger font size */
                font-weight: 600;       /* Bold text */
                line-height: 1.4;       /* Better line spacing */
                margin-top: 10px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);  /* Subtle shadow */
            }
            
            /* Keep rankings simple */
            .ranking-item.enhanced {
                flex-direction: column;
                text-align: center;
                padding: 10px;
                gap: 6px;
                margin-bottom: 8px;
            }
            
            .ranking-left {
                justify-content: center;
                gap: 6px;
            }
            
            .strategy-name {
                font-size: 13px;
            }
            
            .win-rate-bar {
                width: 100px;
                height: 16px;
            }
            
            .detailed-stats {
                justify-content: center;
                font-size: 9px;
                gap: 3px;
            }
        }

        /* FIXED: Better landscape mode - no zooming needed */
        @media (max-width: 900px) and (orientation: landscape) {
            body {
                padding: 2px;
                margin: 0;
            }
            
            .game-container {
                padding: 8px;
                margin: 2px;
                border-radius: 12px;
                max-width: 100vw;
                overflow-x: hidden;
                transform: scale(0.85);    /* Scale down everything slightly */
                transform-origin: top center;
            }
            
            h1 {
                font-size: 1.4rem;
                margin-bottom: 8px;
            }
            
            /* Horizontal layout for game modes */
            .game-mode {
                display: flex;
                flex-direction: row;
                gap: 6px;
                padding: 6px;
                margin-bottom: 10px;
                overflow-x: auto;
            }
            
            .mode-btn {
                flex: 0 0 auto;
                padding: 8px 12px;
                font-size: 11px;
                white-space: nowrap;
                min-width: 100px;
            }
            
            /* Compact board for landscape */
            .board {
                width: min(60vh, 300px);   /* Use height as reference */
                max-width: 300px;
                gap: 0.8vh;
                padding: 1.5vh;
                margin: 8px auto;
                border-radius: 12px;
            }
            
            .cell {
                width: min(12vh, 60px);
                height: min(12vh, 60px);
                max-width: 60px;
                max-height: 60px;
                min-width: 40px;
                min-height: 40px;
                font-size: 1rem;
                border-radius: 8px;
            }
            
            /* Horizontal layout for controls */
            .game-info {
                flex-direction: row;
                gap: 15px;
                justify-content: center;
                align-items: center;
                padding: 6px;
            }
            
            .current-player {
                font-size: 0.9rem;
            }
            
            .reset-btn, .stats-btn {
                padding: 6px 12px;
                font-size: 11px;
                margin: 2px;
            }
            
            /* Compact AI settings */
            .ai-vs-ai-settings {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .ai-config {
                padding: 8px;
            }
            
            .depth-control {
                padding: 8px;
                margin-bottom: 10px;
                font-size: 12px;
            }
            
            /* Compact rules */
            .rules {
                margin-top: 10px;
                padding: 12px;
                border-radius: 12px;
            }
            
            .rules h3 {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }
            
            .rules li {
                font-size: 11px;
                line-height: 1.4;
                margin-bottom: 4px;
            }
            
            /* Show full statistics in landscape */
            #strategyRankings, #matchupMatrix, #detailedResults {
                display: block;
                padding: 6px;
                margin-bottom: 8px;
                font-size: 9px;
            }
            
            /* Remove the rotation message in landscape */
            #matchupMatrix::after,
            #detailedResults::after {
                display: none;
            }
        }

        /* Floating particles background effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.3) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.2) 1px, transparent 1px),
                radial-gradient(circle at 45% 85%, rgba(255, 255, 255, 0.15) 1px, transparent 1px);
            background-size: 50px 50px, 80px 80px, 120px 120px;
            animation: float 20s infinite linear;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100px, -100px); }
        }
        /* Show rotation suggestion on portrait phones */
        /* Portrait phones - make everything work well */

        

        /* Rotation suggestion for portrait phones */
        .rotation-suggestion {
            display: none; /* Hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 10000;
            font-size: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .rotation-suggestion h3 {
            margin: 10px 0;
            color: #4ECDC4;
        }

        .rotation-suggestion p {
            margin: 10px 0;
            line-height: 1.4;
        }

        /* ==========================================
           MAIN GAME CONTAINER
           ========================================== */
        .game-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-radius: 32px;
            padding: 40px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                inset 0 -1px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 720px;
            width: 100%;
            position: relative;
            z-index: 1;
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .game-container:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.2),
                0 12px 40px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 32px;
            pointer-events: none;
        }

        .game-container::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(
                from 0deg at 50% 50%, 
                rgba(255, 255, 255, 0.03) 0deg,
                rgba(255, 255, 255, 0.08) 90deg,
                rgba(255, 255, 255, 0.03) 180deg,
                rgba(255, 255, 255, 0.08) 270deg,
                rgba(255, 255, 255, 0.03) 360deg
            );
            animation: reflectionSpin 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes reflectionSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        h1 {
            text-align: center;
            margin-bottom: 32px;
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.03em;
            position: relative;
            z-index: 1;
            /* text-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); */
            /* animation: titleGlow 3s ease-in-out infinite alternate; */
        }

        /* @keyframes titleGlow {
            0% { filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.4)); }
            100% { filter: drop-shadow(0 0 20px rgba(240, 147, 251, 0.4)); }
        } */

        /* ==========================================
           GAME MODE SELECTION
           ========================================== */
        .game-mode {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-bottom: 36px;
            padding: 6px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .game-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.1) 25%,
                transparent 25%,
                transparent 75%,
                rgba(255, 255, 255, 0.1) 75%
            );
            background-size: 20px 20px;
            border-radius: 20px;
            opacity: 0;
            animation: patternMove 10s linear infinite;
        }

        @keyframes patternMove {
            0% { background-position: 0 0; }
            100% { background-position: 20px 20px; }
        }

        .mode-btn {
            padding: 14px 20px;
            border: none;
            border-radius: 16px;
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 600;
            letter-spacing: -0.01em;
            position: relative;
            overflow: hidden;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .mode-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 16px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mode-btn:hover::before {
            opacity: 1;
        }

        .mode-btn:hover {
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            color: white;
            color: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
            color: rgba(0, 0, 0, 0.9);
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            text-shadow: none;
            transform: translateY(-1px);
            position: relative;
            z-index: 2;
        }

        .mode-btn.active::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #4A90E2, #5A67D8);
            background-size: 300% 300%;
            border-radius: 18px;
            z-index: -1;
            animation: gradientShift 3s ease infinite;
        }

        .mode-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent
            );
            transition: left 0.5s ease;
        }

        .mode-btn:hover::after {
            left: 100%;
        }

        /* ==========================================
           AI SETTINGS & CONTROLS
           ========================================== */
        .ai-settings {
            display: none;
            text-align: center;
            margin-bottom: 28px;
            position: relative;
            z-index: 1;
        }

        .ai-settings.show {
            display: block;
        }

        .depth-control {
            text-align: center;
            margin-bottom: 28px;
            background: rgba(255, 255, 255, 0.4);
            padding: 24px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            font-weight: 600;
            font-size: 16px;
            color: rgba(0, 0, 0, 0.9);
        }

        .depth-control label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.9);
        }

        .ai-vs-ai-settings {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
            position: relative;
            z-index: 1;
        }

        .ai-config {
            background: rgba(255, 255, 255, 0.4);
            padding: 20px;
            border-radius: 16px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        .ai-config.ai-x {
            border-color: rgba(255, 59, 48, 0.2);
        }

        .ai-config.ai-o {
            border-color: rgba(52, 199, 89, 0.2);
        }

        .ai-config h4 {
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .ai-config .ai-x h4 {
            color: rgba(255, 59, 48, 0.9);
        }

        .ai-config .ai-o h4 {
            color: rgba(52, 199, 89, 0.9);
        }

        /* ==========================================
           FORM ELEMENTS (SELECTS & INPUTS)
           ========================================== */
        .difficulty-select,
        .eval-select {
            padding: 12px 18px;
            border-radius: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.8));
            color: rgba(0, 0, 0, 0.9);
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }

        .difficulty-select {
            margin-left: 12px;
        }

        .eval-select {
            width: 100%;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .difficulty-select::before, .eval-select::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(102, 126, 234, 0.1),
                rgba(240, 147, 251, 0.1)
            );
            border-radius: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .difficulty-select:focus::before, .eval-select:focus::before {
            opacity: 1;
        }

        .difficulty-select:focus,
        .eval-select:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            box-shadow: 
                0 0 0 4px rgba(102, 126, 234, 0.2),
                0 8px 32px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        .difficulty-select:hover,
        .eval-select:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.95));
            transform: translateY(-3px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.15),
                0 4px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .difficulty-select:active,
        .eval-select:active {
            transform: translateY(0);
            box-shadow:
                0 2px 8px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .difficulty-select option,
        .eval-select option {
            background: white;
            color: rgba(0, 0, 0, 0.87);
        }

        .eval-description {
            font-size: 13px;
            color: rgba(0, 0, 0, 0.6);
            margin-top: 8px;
            line-height: 1.4;
        }

        /* ==========================================
           TOGGLE SWITCHES
           ========================================== */
        .hot-blocking-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            text-align: center;
            margin-bottom: 28px;
            background: rgba(255, 255, 255, 0.4);
            padding: 24px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            font-weight: 600;
            font-size: 16px;
            color: rgba(0, 0, 0, 0.9);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 64px;
            height: 36px;
            margin-left: 16px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(200, 200, 200, 0.6);
            transition: 0.3s;
            border-radius: 36px;
            box-shadow: 
                inset 0 2px 8px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 28px;
            width: 28px;
            left: 4px;
            bottom: 4px;
            background: rgba(255, 255, 255, 0.9);
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.2),
                0 2px 4px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        input:checked + .slider {
            background: rgba(34, 197, 94, 0.7);
            box-shadow: 
                inset 0 2px 8px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(34, 197, 94, 0.3),
                0 0 20px rgba(34, 197, 94, 0.2);
        }

        input:checked + .slider:before {
            transform: translateX(28px);
            background: rgba(255, 255, 255, 1);
            box-shadow: 
                0 4px 16px rgba(34, 197, 94, 0.4),
                0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* ==========================================
           GAME CONTROLS & INTERFACE
           ========================================== */
        .game-controls {
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .game-controls.hidden {
            display: none;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            background: rgba(255, 255, 255, 0.4);
            padding: 24px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .current-player {
            font-size: 1.3rem;
            font-weight: 700;
            color: rgba(0, 0, 0, 0.9);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        /* ==========================================
           BUTTONS
           ========================================== */
        .reset-btn, 
        .stats-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 16px;
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            color: white;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.01em;
            box-shadow: 
                0 6px 20px rgba(255, 107, 107, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            transform-style: preserve-3d;
        }

        .stats-btn {
            background: linear-gradient(135deg, #667eea, #5a67d8);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.3),
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            margin-left: 16px;
        }

        .reset-btn::after, .stats-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent
            );
            transition: left 0.5s ease;
        }

        .reset-btn:hover::after, .stats-btn:hover::after {
            left: 100%;
        }

        .reset-btn:hover, .stats-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 12px 40px rgba(255, 107, 107, 0.4),
                0 4px 16px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .stats-btn:hover {
            box-shadow: 
                0 12px 40px rgba(102, 126, 234, 0.4),
                0 4px 16px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .reset-btn:active, .stats-btn:active {
            transform: translateY(-1px) scale(1.01);
            transition: all 0.1s ease;
        }

        .primary-button {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            padding: 12px 24px;
            font-weight: 500;
            font-size: 15px;
            letter-spacing: -0.01em;
            position: relative;
            overflow: hidden;
        }

        .primary-button:hover {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            transform: scale(1.05);
            cursor: pointer;
        }

        .primary-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent
            );
            transition: left 0.5s ease;
        }

        .primary-button:hover::after {
            left: 100%;
        }

        /* Button ripple effects */
        .reset-btn::before, .stats-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }

        .reset-btn:active::before, .stats-btn:active::before {
            width: 120%;
            height: 120%;
        }

        /* ==========================================
           GAME BOARD
           ========================================== */
        .board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: min(2vw, 2vh, 15px);           /* Uses smallest of width%, height%, or 15px */
            margin: 4vh auto;
            width: min(90vw, 90vh, 500px);      /* Uses smallest dimension */
            max-width: 500px;
            padding: min(3vw, 3vh, 25px);       /* Responsive padding */
            background: rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            justify-items: center;
            align-items: center;
        }

        .board.disabled {
            pointer-events: none;
            position: relative;
        }

        .board.disabled::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(
                circle at center,
                rgba(102, 126, 234, 0.1) 0%,
                rgba(240, 147, 251, 0.1) 50%,
                rgba(102, 126, 234, 0.1) 100%
            );
            background-size: 200% 200%;
            border-radius: 24px;
            animation: loadingPulse 2s ease-in-out infinite;
            backdrop-filter: blur(2px);
            z-index: 10;
        }
        @keyframes loadingPulse {
            0%, 100% { 
                background-position: 0% 50%;
                opacity: 0.5;
            }
            50% { 
                background-position: 100% 50%;
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <div class="rotation-suggestion">
        <div style="font-size: 48px; margin-bottom: 15px;">📱➡️📱</div>
        <h3>Better Gaming Experience</h3>
        <p>This game works best in <strong>landscape mode</strong>!</p>
        <p>Please rotate your phone horizontally for:</p>
        <ul style="text-align: left; margin: 15px 0;">
            <li>✅ Larger game board</li>
            <li>✅ Better button layout</li>
            <li>✅ Full statistics view</li>
        </ul>
        <div style="font-size: 32px; margin-top: 15px; animation: spin 2s linear infinite;">🔄</div>
    </div>

    <style>
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    </style>
    <div class="game-container">
        <h1>Square-Three</h1>
        
        <div class="game-mode">
            <button class="mode-btn active" onclick="setGameMode('human')">Human vs Human</button>
            <button class="mode-btn" onclick="setGameMode('ai')">Human vs AI</button>
            <button class="mode-btn" onclick="setGameMode('aivsai')">AI vs AI</button>
            <button class="mode-btn" onclick="setGameMode('statistics')">Multi-Game Stats</button>
        </div>

        <div class="ai-settings" id="aiSettings">
            <div id="humanVsAiSettings", class = "depth-control">
                <label>AI Difficulty:</label>
                <select class="difficulty-select" id="aiDifficulty">
                    <option value="2">Very Easy (Depth 2)</option>
                    <option value="3">Easy (Depth 3)</option>
                    <option value="4" selected>Medium (Depth 4)</option>
                    <option value="5">Hard (Depth 5)</option>
                    <option value="6">Expert (Depth 6)</option>
                </select>
                <div style="margin-top: 15px;">
                    <label>AI Strategy:</label>
                    <select class="difficulty-select" id="aiStrategy">
                        <option value="pattern">Pattern-Based (Balanced)</option>
                        <option value="aggressive">Aggressive (Attack Focus)</option>
                        <option value="defensive">Defensive (Block Focus)</option>
                        <option value="positional">Positional (Board Control)</option>
                        <option value="material">Material (Token Count)</option>
                    </select>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 15px;">
                        <label>Hot Adjacency Blocking:</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="aiHotBlocking" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div id="aiVsAiSettings" style="display: none;">
                <div class="depth-control" >
                    <label>Search Depth (Both AIs):</label>
                    <select class="difficulty-select" id="sharedDepth">
                        <option value="2">Depth 2 (Very Fast)</option>
                        <option value="3">Depth 3 (Fast)</option>
                        <option value="4" selected>Depth 4 (Medium)</option>
                        <option value="5">Depth 5 (Slow)</option>
                        <option value="6">Depth 6 (Very Slow)</option>
                    </select>
                   <div style="display: flex; align-items: center; justify-content: center; gap: 10px;margin-top: 15px;">
                        <label>Hot Adjacency Blocking:</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="aiVsAiHotBlocking" checked>
                            <span class="slider"></span>
                        </label>
                </div>
                </div>
                
                <div class="ai-vs-ai-settings">
                    <div class="ai-config ai-x">
                        <h4 style="color: #ff6b6b;">AI X Strategy</h4>
                        <select class="eval-select" id="aiXStrategy">
                            <option value="pattern">Pattern-Based</option>
                            <option value="aggressive" selected>Aggressive</option>
                            <option value="defensive">Defensive</option>
                            <option value="positional">Positional</option>
                            <option value="material">Material</option>
                        </select>
                        <div class="eval-description" id="aiXDescription">
                            Focuses on creating winning threats and attacking patterns.
                        </div>
                    </div>
                    
                    <div class="ai-config ai-o">
                        <h4 style="color: #4ecdc4;">AI O Strategy</h4>
                        <select class="eval-select" id="aiOStrategy">
                            <option value="pattern">Pattern-Based</option>
                            <option value="aggressive">Aggressive</option>
                            <option value="defensive" selected>Defensive</option>
                            <option value="positional">Positional</option>
                            <option value="material">Material</option>
                        </select>
                        <div class="eval-description" id="aiODescription">
                            Prioritizes blocking opponent threats and defensive play.
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; text-align: center;">
                    <button class="mode-btn primary-button" onclick="startAiVsAi()">Start AI Battle</button>
                    <button class="mode-btn primary-button" onclick="pauseAiVsAi()" id="pauseBtn" style="display: none;">Pause</button>
                </div>
            </div>
        </div>

        <div class="ai-settings" id="statisticsSettings" style="display: none;">
            <div class="depth-control">
                <div style="margin-bottom: 16px;">
                    <label>Test Depth (Both AIs):</label>
                    <select class="difficulty-select" id="testDepth">
                        <option value="2">Depth 2 (Very Fast)</option>
                        <option value="3">Depth 3 (Fast)</option>
                        <option value="4" selected>Depth 4 (Medium)</option>
                        <option value="5">Depth 5 (Slow)</option>
                        <option value="6">Depth 6 (Very Slow)</option>
                    </select>
                </div>

                <div style="margin-bottom: 16px;">
                    <label>Number of Games per Combination:</label>
                    <select class="difficulty-select" id="gamesPerCombo">
                        <option value="5">5 Games (Quick)</option>
                        <option value="10" selected>10 Games (Standard)</option>
                        <option value="20">20 Games (Thorough)</option>
                        <option value="50">50 Games (Comprehensive)</option>
                    </select>
                </div>

                <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <label>Hot Adjacency Blocking:</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="statsHotBlocking" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>


            <div style="text-align: center; margin-bottom: 20px;">
                <button class="mode-btn primary-button" onclick="startFullStatistics()" id="fullStatsBtn">
                    Run Full Statistics Test
                </button>
                <button class="mode-btn primary-button" onclick="stopFullStatistics()" id="stopStatsBtn" style="display: none;">
                    Stop Test
                </button>
            </div>

            <div id="statisticsProgress" style="display: none; margin-bottom: 20px; background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px;">
                <div style="text-align: center; margin-bottom: 10px;">
                    <strong id="currentTestInfo">Testing: Aggressive (X - goes first) vs Defensive (O - goes second)</strong>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 10px; height: 20px; overflow: hidden;">
                    <div id="progressBar" style="background: linear-gradient(45deg, #FFD700, #FFA500); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <div style="text-align: center; margin-top: 5px;">
                    <span id="progressText">0% - 0/250 games completed</span>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 12px; color: rgba(0, 0, 0, 0.7);">
                    <strong>Note:</strong> Each strategy plays both as X (first player) and O (second player) against every other strategy.<br>
                    Going first can provide an advantage, so both positions are tested for fair comparison.
                </div>
            </div>

            <div id="fullStatisticsResults" style="display: none;">
                <h3 style="text-align: center; color: #FFD700; margin-bottom: 15px;">Complete Strategy Analysis</h3>
                
                <div id="strategyRankings" style="margin-bottom: 20px; background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px;">
                    <h4 style="color: #FFD700; margin-bottom: 10px;">Strategy Rankings</h4>
                    <div id="rankingsList"></div>
                </div>

                <div id="matchupMatrix" style="margin-bottom: 20px; background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px;">
                    <h4 style="color: #FFD700; margin-bottom: 10px;">Head-to-Head Matrix</h4>
                    <div id="matrixTable"></div>
                </div>

                <div id="detailedResults" style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 15px;">
                    <h4 style="color: #FFD700; margin-bottom: 10px;">Detailed Results</h4>
                    <div id="detailsList"></div>
                </div>
            </div>
        </div>

        <div class="game-controls" id="gameControls">
            <div class="hot-blocking-toggle" id="hotBlockingContainer" >
                <span id="hotBlockingLabel" class="toggle-label">Hot Adjacency Blocking:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="hotBlocking" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <div class="game-info">
                <div class="current-player" id="currentPlayer">Current Player: X</div>
                <button class="reset-btn" onclick="resetGame()">New Game</button>
            </div>

            <div class="board" id="board"></div>

            <div class="game-status" id="gameStatus"></div>

            <div class="rules">
                <h3>How to Play:</h3>
                <ul>
                    <li><strong>Win by Line:</strong> Get 4 in a row (horizontal, vertical, or diagonal)</li>
                    <li><strong>Win by Square:</strong> Get all 4 corners of any 2×2 square</li>
                    <li><strong>Hot Blocking:</strong> When enabled, you can't play adjacent to the last move</li>
                    <li><strong>AI Strategies:</strong> Each AI uses different evaluation functions for unique playstyles</li>
                    <li><strong>Strategy:</strong> Block your opponent while creating your own winning patterns!</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        class SquareThree {
            constructor(hotBlocking = true) {
                this.board = Array(16).fill('.');
                this.lastMove = null;
                this.hotBlocking = hotBlocking;
            }

            coord(idx) {
                return [Math.floor(idx / 4), idx % 4];
            }

            index(row, col) {
                return row * 4 + col;
            }

            isAdjacent(a, b) {
                if (a === null || b === null) return false;
                const [r1, c1] = this.coord(a);
                const [r2, c2] = this.coord(b);
                return (Math.abs(r1 - r2) === 1 && c1 === c2) || 
                       (Math.abs(c1 - c2) === 1 && r1 === r2);
            }

            legalMoves() {
                const moves = [];
                for (let i = 0; i < 16; i++) {
                    if (this.board[i] === '.') {
                        if (!this.hotBlocking || this.lastMove === null || !this.isAdjacent(this.lastMove, i)) {
                            moves.push(i);
                        }
                    }
                }
                return moves;
            }

            lineWin(player) {
                // Check rows and columns
                for (let r = 0; r < 4; r++) {
                    if (Array.from({length: 4}, (_, c) => this.board[this.index(r, c)]).every(cell => cell === player)) {
                        return true;
                    }
                }
                for (let c = 0; c < 4; c++) {
                    if (Array.from({length: 4}, (_, r) => this.board[this.index(r, c)]).every(cell => cell === player)) {
                        return true;
                    }
                }
                // Check diagonals
                if (Array.from({length: 4}, (_, i) => this.board[this.index(i, i)]).every(cell => cell === player)) {
                    return true;
                }
                if (Array.from({length: 4}, (_, i) => this.board[this.index(i, 3 - i)]).every(cell => cell === player)) {
                    return true;
                }
                return false;
            }

            squareWin(player) {
                for (let r = 0; r < 3; r++) {
                    for (let c = 0; c < 3; c++) {
                        const corners = [
                            this.index(r, c), this.index(r, c + 1),
                            this.index(r + 1, c), this.index(r + 1, c + 1)
                        ];
                        if (corners.every(i => this.board[i] === player)) {
                            return true;
                        }
                    }
                }
                return false;
            }

            wins(player) {
                return this.lineWin(player) || this.squareWin(player);
            }

            isFull() {
                return this.board.every(cell => cell !== '.');
            }

            play(idx, player) {
                const prevLast = this.lastMove;
                this.board[idx] = player;
                this.lastMove = idx;
                return prevLast;
            }

            undo(idx, prevLast) {
                this.board[idx] = '.';
                this.lastMove = prevLast;
            }
        }

        // Evaluation Functions
        function evalMaterial(game, me, opp) {
            return game.board.filter(cell => cell === me).length - 
                   game.board.filter(cell => cell === opp).length;
        }

        function evalPattern(game, me, opp) {
            let score = 0;

            // Lines (rows, columns, diagonals)
            const lines = [];
            for (let r = 0; r < 4; r++) {
                lines.push(Array.from({length: 4}, (_, c) => game.index(r, c)));
            }
            for (let c = 0; c < 4; c++) {
                lines.push(Array.from({length: 4}, (_, r) => game.index(r, c)));
            }
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, i)));
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, 3 - i)));

            for (const line of lines) {
                const cells = line.map(i => game.board[i]);
                const myCount = cells.filter(cell => cell === me).length;
                const oppCount = cells.filter(cell => cell === opp).length;
                const emptyCount = cells.filter(cell => cell === '.').length;
                
                if (oppCount === 0) {
                    if (myCount === 3 && emptyCount === 1) score += 50;
                    else if (myCount === 2 && emptyCount === 2) score += 10;
                    else if (myCount === 1 && emptyCount === 3) score += 1;
                }
                if (myCount === 0) {
                    if (oppCount === 3 && emptyCount === 1) score -= 50;
                    else if (oppCount === 2 && emptyCount === 2) score -= 10;
                    else if (oppCount === 1 && emptyCount === 3) score -= 1;
                }
            }

            // Squares
            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 3; c++) {
                    const corners = [
                        game.index(r, c), game.index(r, c + 1),
                        game.index(r + 1, c), game.index(r + 1, c + 1)
                    ];
                    const myCount = corners.filter(i => game.board[i] === me).length;
                    const oppCount = corners.filter(i => game.board[i] === opp).length;
                    const emptyCount = corners.filter(i => game.board[i] === '.').length;
                    
                    if (oppCount === 0) {
                        if (myCount === 3 && emptyCount === 1) score += 60;
                        else if (myCount === 2 && emptyCount === 2) score += 15;
                        else if (myCount === 1 && emptyCount === 3) score += 2;
                    }
                    if (myCount === 0) {
                        if (oppCount === 3 && emptyCount === 1) score -= 60;
                        else if (oppCount === 2 && emptyCount === 2) score -= 15;
                        else if (oppCount === 1 && emptyCount === 3) score -= 2;
                    }
                }
            }

            // Center control bonus
            const center = [game.index(1, 1), game.index(1, 2), game.index(2, 1), game.index(2, 2)];
            score += center.filter(i => game.board[i] === me).length;
            score -= center.filter(i => game.board[i] === opp).length;

            return score;
        }

        function evalAggressive(game, me, opp) {
            let score = 0;

            // Heavily favor creating threats
            const lines = [];
            for (let r = 0; r < 4; r++) {
                lines.push(Array.from({length: 4}, (_, c) => game.index(r, c)));
            }
            for (let c = 0; c < 4; c++) {
                lines.push(Array.from({length: 4}, (_, r) => game.index(r, c)));
            }
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, i)));
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, 3 - i)));

            for (const line of lines) {
                const cells = line.map(i => game.board[i]);
                const myCount = cells.filter(cell => cell === me).length;
                const oppCount = cells.filter(cell => cell === opp).length;
                const emptyCount = cells.filter(cell => cell === '.').length;
                
                if (oppCount === 0) {
                    if (myCount === 3 && emptyCount === 1) score += 100; // Much higher for threats
                    else if (myCount === 2 && emptyCount === 2) score += 25;
                    else if (myCount === 1 && emptyCount === 3) score += 3;
                }
                if (myCount === 0 && oppCount === 3 && emptyCount === 1) {
                    score -= 30; // Less defensive focus
                }
            }

            // Squares - even more aggressive
            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 3; c++) {
                    const corners = [
                        game.index(r, c), game.index(r, c + 1),
                        game.index(r + 1, c), game.index(r + 1, c + 1)
                    ];
                    const myCount = corners.filter(i => game.board[i] === me).length;
                    const oppCount = corners.filter(i => game.board[i] === opp).length;
                    const emptyCount = corners.filter(i => game.board[i] === '.').length;
                    
                    if (oppCount === 0) {
                        if (myCount === 3 && emptyCount === 1) score += 120;
                        else if (myCount === 2 && emptyCount === 2) score += 30;
                    }
                    if (myCount === 0 && oppCount === 3 && emptyCount === 1) {
                        score -= 40;
                    }
                }
            }

            return score;
        }

        function evalDefensive(game, me, opp) {
            let score = 0;

            // Focus heavily on blocking opponent threats
            const lines = [];
            for (let r = 0; r < 4; r++) {
                lines.push(Array.from({length: 4}, (_, c) => game.index(r, c)));
            }
            for (let c = 0; c < 4; c++) {
                lines.push(Array.from({length: 4}, (_, r) => game.index(r, c)));
            }
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, i)));
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, 3 - i)));

            for (const line of lines) {
                const cells = line.map(i => game.board[i]);
                const myCount = cells.filter(cell => cell === me).length;
                const oppCount = cells.filter(cell => cell === opp).length;
                const emptyCount = cells.filter(cell => cell === '.').length;
                
                if (myCount === 0) {
                    if (oppCount === 3 && emptyCount === 1) score -= 100; // Heavily penalize opponent threats
                    else if (oppCount === 2 && emptyCount === 2) score -= 30;
                    else if (oppCount === 1 && emptyCount === 3) score -= 5;
                }
                if (oppCount === 0) {
                    if (myCount === 3 && emptyCount === 1) score += 40; // Lower offensive focus
                    else if (myCount === 2 && emptyCount === 2) score += 8;
                }
            }

            // Squares - defensive focus
            for (let r = 0; r < 3; r++) {
                for (let c = 0; c < 3; c++) {
                    const corners = [
                        game.index(r, c), game.index(r, c + 1),
                        game.index(r + 1, c), game.index(r + 1, c + 1)
                    ];
                    const myCount = corners.filter(i => game.board[i] === me).length;
                    const oppCount = corners.filter(i => game.board[i] === opp).length;
                    const emptyCount = corners.filter(i => game.board[i] === '.').length;
                    
                    if (myCount === 0) {
                        if (oppCount === 3 && emptyCount === 1) score -= 120;
                        else if (oppCount === 2 && emptyCount === 2) score -= 35;
                    }
                    if (oppCount === 0) {
                        if (myCount === 3 && emptyCount === 1) score += 50;
                        else if (myCount === 2 && emptyCount === 2) score += 10;
                    }
                }
            }

            return score;
        }

        function evalPositional(game, me, opp) {
            let score = 0;

            // Strong center control
            const center = [game.index(1, 1), game.index(1, 2), game.index(2, 1), game.index(2, 2)];
            score += 10 * center.filter(i => game.board[i] === me).length;
            score -= 10 * center.filter(i => game.board[i] === opp).length;

            // Corner control
            const corners = [game.index(0, 0), game.index(0, 3), game.index(3, 0), game.index(3, 3)];
            score += 5 * corners.filter(i => game.board[i] === me).length;
            score -= 5 * corners.filter(i => game.board[i] === opp).length;

            // Edge control
            const edges = [];
            for (let i = 0; i < 4; i++) {
                edges.push(game.index(0, i), game.index(3, i), game.index(i, 0), game.index(i, 3));
            }
            const uniqueEdges = [...new Set(edges)].filter(i => !center.includes(i) && !corners.includes(i));
            score += 3 * uniqueEdges.filter(i => game.board[i] === me).length;
            score -= 3 * uniqueEdges.filter(i => game.board[i] === opp).length;

            // Basic pattern scoring (lighter than pattern-based)
            const lines = [];
            for (let r = 0; r < 4; r++) {
                lines.push(Array.from({length: 4}, (_, c) => game.index(r, c)));
            }
            for (let c = 0; c < 4; c++) {
                lines.push(Array.from({length: 4}, (_, r) => game.index(r, c)));
            }
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, i)));
            lines.push(Array.from({length: 4}, (_, i) => game.index(i, 3 - i)));

            for (const line of lines) {
                const cells = line.map(i => game.board[i]);
                const myCount = cells.filter(cell => cell === me).length;
                const oppCount = cells.filter(cell => cell === opp).length;
                const emptyCount = cells.filter(cell => cell === '.').length;
                
                if (oppCount === 0) {
                    if (myCount === 3 && emptyCount === 1) score += 30;
                    else if (myCount === 2 && emptyCount === 2) score += 5;
                }
                if (myCount === 0) {
                    if (oppCount === 3 && emptyCount === 1) score -= 30;
                    else if (oppCount === 2 && emptyCount === 2) score -= 5;
                }
            }

            return score;
        }

        // Get evaluation function by name
        function getEvalFunction(strategy) {
            switch (strategy) {
                case 'material': return evalMaterial;
                case 'aggressive': return evalAggressive;
                case 'defensive': return evalDefensive;
                case 'positional': return evalPositional;
                case 'pattern':
                default: return evalPattern;
            }
        }

        function minimax(game, depth, alpha, beta, maximizing, me, opp, evalFunc, useRandomness = true, gameNumber = 0) {
            if (game.wins(me)) return [10000 - depth, null];
            if (game.wins(opp)) return [-10000 + depth, null];
            if (depth === 0 || game.isFull()) {
                let score = evalFunc(game, me, opp);
                // Add evaluation noise and game-specific variation
                if (useRandomness) {
                    // Stronger noise for more variation
                    const noise = score * 0.15 * (Math.random() * 2 - 1);
                    // Add game-specific deterministic variation based on game number
                    const gameVariation = score * 0.1 * Math.sin(gameNumber * 0.7 + depth);
                    score += noise + gameVariation;
                }
                return [score, null];
            }

            const moves = game.legalMoves();
            
            // Handle case where no legal moves are available
            if (moves.length === 0) {
                let score = evalFunc(game, me, opp);
                if (useRandomness) {
                    const noise = score * 0.15 * (Math.random() * 2 - 1);
                    const gameVariation = score * 0.1 * Math.sin(gameNumber * 0.7 + depth);
                    score += noise + gameVariation;
                }
                return [score, null];
            }

            // Randomize move order to prevent deterministic patterns
            if (useRandomness) {
                for (let i = moves.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [moves[i], moves[j]] = [moves[j], moves[i]];
                }
            }

            const moveScores = [];

            if (maximizing) {
                let value = -Infinity;
                for (const move of moves) {
                    const prev = game.play(move, me);
                    const [score] = minimax(game, depth - 1, alpha, beta, false, me, opp, evalFunc, useRandomness, gameNumber);
                    game.undo(move, prev);
                    
                    moveScores.push({ move, score });
                    value = Math.max(value, score);
                    alpha = Math.max(alpha, score);
                    if (beta <= alpha) break;
                }
                
                // Ensure we have valid moveScores before processing
                if (moveScores.length === 0) {
                    return [evalFunc(game, me, opp), null];
                }
                
                // Enhanced randomness: select from top moves with weighted probability
                if (useRandomness) {
                    const bestScore = Math.max(...moveScores.map(ms => ms.score));
                    const tolerance = 10; // Allow moves within 10 points of best
                    const goodMoves = moveScores.filter(ms => ms.score >= bestScore - tolerance);
                    
                    if (goodMoves.length === 0) {
                        return [moveScores[0].score, moveScores[0].move];
                    }
                    
                    // Weighted selection: better moves have higher probability
                    const weights = goodMoves.map(ms => Math.exp((ms.score - bestScore + tolerance) / 10));
                    const totalWeight = weights.reduce((sum, w) => sum + w, 0);
                    const random = Math.random() * totalWeight;
                    
                    let weightSum = 0;
                    for (let i = 0; i < goodMoves.length; i++) {
                        weightSum += weights[i];
                        if (random <= weightSum) {
                            return [goodMoves[i].score, goodMoves[i].move];
                        }
                    }
                    
                    return [goodMoves[goodMoves.length - 1].score, goodMoves[goodMoves.length - 1].move];
                } else {
                    const bestMove = moveScores.reduce((best, current) => 
                        current.score > best.score ? current : best
                    );
                    return [bestMove.score, bestMove.move];
                }
            } else {
                let value = Infinity;
                for (const move of moves) {
                    const prev = game.play(move, opp);
                    const [score] = minimax(game, depth - 1, alpha, beta, true, me, opp, evalFunc, useRandomness, gameNumber);
                    game.undo(move, prev);
                    
                    moveScores.push({ move, score });
                    value = Math.min(value, score);
                    beta = Math.min(beta, score);
                    if (beta <= alpha) break;
                }
                
                // Ensure we have valid moveScores before processing
                if (moveScores.length === 0) {
                    return [evalFunc(game, me, opp), null];
                }
                
                // Enhanced randomness for minimizing player
                if (useRandomness) {
                    const bestScore = Math.min(...moveScores.map(ms => ms.score));
                    const tolerance = 10;
                    const goodMoves = moveScores.filter(ms => ms.score <= bestScore + tolerance);
                    
                    if (goodMoves.length === 0) {
                        return [moveScores[0].score, moveScores[0].move];
                    }
                    
                    // Weighted selection for minimizing player
                    const weights = goodMoves.map(ms => Math.exp(-(ms.score - bestScore + tolerance) / 10));
                    const totalWeight = weights.reduce((sum, w) => sum + w, 0);
                    const random = Math.random() * totalWeight;
                    
                    let weightSum = 0;
                    for (let i = 0; i < goodMoves.length; i++) {
                        weightSum += weights[i];
                        if (random <= weightSum) {
                            return [goodMoves[i].score, goodMoves[i].move];
                        }
                    }
                    
                    return [goodMoves[goodMoves.length - 1].score, goodMoves[goodMoves.length - 1].move];
                } else {
                    const bestMove = moveScores.reduce((best, current) => 
                        current.score < best.score ? current : best
                    );
                    return [bestMove.score, bestMove.move];
                }
            }
        }

        function chooseMove(game, player, depth, strategy, useRandomness = true) {
            const me = player;
            const opp = player === 'X' ? 'O' : 'X';
            const evalFunc = getEvalFunction(strategy);
            const [, move] = minimax(game, depth, -Infinity, Infinity, true, me, opp, evalFunc, useRandomness);
            return move;
        }

        // Game State
        let game;
        let currentPlayer = 'X';
        let gameMode = 'human'; // 'human', 'ai', 'aivsai', or 'statistics'
        let gameEnded = false;
        let aiDifficulty = 4;
        let aiStrategy = 'pattern';
        let sharedDepth = 4;
        let aiXStrategy = 'aggressive';
        let aiOStrategy = 'defensive';
        let aiVsAiRunning = false;
        let aiVsAiPaused = false;
        let fullStatsRunning = false;

        // Full statistics tracking
        let fullStatsData = {
            strategies: ['pattern', 'aggressive', 'defensive', 'positional', 'material'],
            results: {}, // Will store results for each combination
            currentCombo: 0,
            totalCombos: 0,
            currentGameInCombo: 0,
            gamesPerCombo: 10,
            testDepth: 4
        };

        // Strategy descriptions
        const strategyDescriptions = {
            'pattern': 'Balanced approach focusing on both offensive and defensive patterns.',
            'aggressive': 'Focuses on creating winning threats and attacking patterns.',
            'defensive': 'Prioritizes blocking opponent threats and defensive play.',
            'positional': 'Emphasizes board control and strategic positioning.',
            'material': 'Simple strategy based on token count and basic evaluation.'
        };

        function updateStrategyDescription(selectId, descriptionId) {
            const select = document.getElementById(selectId);
            const description = document.getElementById(descriptionId);
            if (select && description) {
                description.textContent = strategyDescriptions[select.value];
            }
        }

        function initGame() {
            let hotBlocking;
            if (gameMode === 'statistics') {
                hotBlocking = document.getElementById('statsHotBlocking').checked;
            } else if (gameMode === 'ai') {
                // Use the Human vs AI settings hot blocking toggle
                hotBlocking = document.getElementById('aiHotBlocking').checked;
            } else if (gameMode === 'aivsai') {
                // Use the AI vs AI settings hot blocking toggle
                hotBlocking = document.getElementById('aiVsAiHotBlocking').checked;
            } else {
                // Human vs Human mode
                hotBlocking = document.getElementById('hotBlocking').checked;
            }
            game = new SquareThree(hotBlocking);
            currentPlayer = 'X';
            gameEnded = false;
            updateDisplay();
        }

        function setGameMode(mode) {
            gameMode = mode;
            aiVsAiRunning = false;
            aiVsAiPaused = false;
            fullStatsRunning = false;
            
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            const hotBlockingLabel = document.getElementById('hotBlockingLabel');
            if (hotBlockingLabel){
                hotBlockingLabel.style.display = (mode === 'human') ? 'inline-block' : 'none';
            }
            const hotBlockingContainer = document.getElementById('hotBlockingContainer');
            if (hotBlockingContainer) {
                // מוצג רק ב-Human vs Human
                hotBlockingContainer.style.display = (mode === 'human') ? 'block' : 'none';
            }
            // const hotBlockingContainer = document.getElementById('hotBlockingContainer');
            // if (hotBlockingContainer) hotBlockingContainer.style.display = 'block';
            const aiSettings = document.getElementById('aiSettings');
            const humanVsAiSettings = document.getElementById('humanVsAiSettings');
            const aiVsAiSettings = document.getElementById('aiVsAiSettings');
            const statisticsSettings = document.getElementById('statisticsSettings');
            const gameControls = document.getElementById('gameControls');
            const pauseBtn = document.getElementById('pauseBtn');
            
            // Hide all settings first
            if (aiSettings) aiSettings.classList.remove('show');
            if (humanVsAiSettings) humanVsAiSettings.style.display = 'none';
            if (aiVsAiSettings) aiVsAiSettings.style.display = 'none';
            if (statisticsSettings) statisticsSettings.style.display = 'none';
            if (pauseBtn) pauseBtn.style.display = 'none';
            
            // Show/hide game controls based on mode
            if (gameControls) {
                if (mode === 'statistics') {
                    gameControls.classList.add('hidden');
                } else {
                    gameControls.classList.remove('hidden');
                }
            }
            
            if (mode === 'ai') {
                if (aiSettings) aiSettings.classList.add('show');
                if (humanVsAiSettings) humanVsAiSettings.style.display = 'block';
            } else if (mode === 'aivsai') {
                if (aiSettings) aiSettings.classList.add('show');
                if (aiVsAiSettings) aiVsAiSettings.style.display = 'block';
            } else if (mode === 'statistics') {
                if (statisticsSettings) statisticsSettings.style.display = 'block';
            }
            
            if (mode !== 'statistics') {
                resetGame();
            }
        }

        function resetGame() {
            aiVsAiRunning = false;
            aiVsAiPaused = false;
            fullStatsRunning = false;
            
            const pauseBtn = document.getElementById('pauseBtn');
            const fullStatsBtn = document.getElementById('fullStatsBtn');
            const stopStatsBtn = document.getElementById('stopStatsBtn');
            
            if (pauseBtn) pauseBtn.style.display = 'none';
            if (fullStatsBtn) fullStatsBtn.style.display = 'inline-block';
            if (stopStatsBtn) stopStatsBtn.style.display = 'none';
            
            if (gameMode !== 'statistics') {
                initGame();
            }
        }
                function updateDisplay() {
            if (gameMode === 'statistics') return; // Don't update display in statistics mode
            
            const board = document.getElementById('board');
            const currentPlayerDiv = document.getElementById('currentPlayer');
            const gameStatus = document.getElementById('gameStatus');

            // Update board
            if (board) {
                // Store which cells already have content to avoid re-animating them
                const existingCells = Array.from(board.querySelectorAll('.cell')).map(cell => ({
                    content: cell.textContent,
                    classes: Array.from(cell.classList)
                }));
                
                board.innerHTML = '';
                
                // Remove the disabled class - we'll handle click prevention differently
                board.classList.remove('disabled');
                
                for (let i = 0; i < 16; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.textContent = game.board[i] === '.' ? '' : game.board[i];
                    
                    if (game.board[i] !== '.') {
                        cell.classList.add(game.board[i]);
                        
                        // Only add animation if this is a new symbol
                        const wasEmpty = !existingCells[i] || existingCells[i].content === '';
                        if (wasEmpty && cell.textContent !== '') {
                            cell.classList.add('just-played');
                            // Remove the animation class after animation completes
                            setTimeout(() => {
                                cell.classList.remove('just-played');
                            }, 600);
                        }
                    }
                    
                    if (i === game.lastMove) {
                        cell.classList.add('last-move');
                    }
                    
                    const legalMoves = game.legalMoves();
                    if (game.board[i] === '.' && !legalMoves.includes(i)) {
                        cell.classList.add('blocked');
                    }
                    
                    cell.onclick = () => makeMove(i);
                    
                    // Disable clicking in AI vs AI mode but keep normal appearance
                    if (gameMode === 'aivsai') {
                        cell.style.cursor = 'default';
                        cell.style.pointerEvents = 'none';
                        // Keep normal opacity and appearance
                        cell.style.opacity = '1';
                    } else if (gameMode !== 'statistics') {
                        cell.style.cursor = 'pointer';
                        cell.style.opacity = '1';
                        cell.style.pointerEvents = 'auto';
                    }
                    board.appendChild(cell);
                }
            }

            // Update current player
            if (currentPlayerDiv && !gameEnded) {
                if (gameMode === 'aivsai') {
                    const currentStrategy = currentPlayer === 'X' ? aiXStrategy : aiOStrategy;
                    const statusText = aiVsAiRunning ? (aiVsAiPaused ? '(Paused)' : '(Thinking...)') : '(Ready)';
                    currentPlayerDiv.innerHTML = `<span style="color: rgba(0, 0, 0, 0.8); font-weight: 500;">AI Battle:</span> <span style="color: ${currentPlayer === 'X' ? '#ff6b6b' : '#4ecdc4'}; font-weight: 600;">AI ${currentPlayer}</span> <span style="color: rgba(0, 0, 0, 0.7);">(${currentStrategy.charAt(0).toUpperCase() + currentStrategy.slice(1)}) <span style="color: rgba(0, 0, 0, 0.6); font-style: italic;">${statusText}</span></span>`;
                } else {
                    currentPlayerDiv.textContent = `Current Player: ${currentPlayer}`;
                    currentPlayerDiv.style.color = currentPlayer === 'X' ? '#ff6b6b' : '#4ecdc4';
                }
            }

            // Check game status
            if (gameStatus) {
                if (game.wins('X')) {
                    // Show X-strategy only in AI-vs-AI mode
                    const strategy =
                        gameMode === 'aivsai'
                            ? ` (${aiXStrategy.charAt(0).toUpperCase() + aiXStrategy.slice(1)})`
                            : '';
                    gameStatus.innerHTML = `🎉 <span class="winner">Player X${strategy} Wins!</span> 🎉`;
                    gameEnded = true;

                } else if (game.wins('O')) {
                    const strategy =
                        gameMode === 'aivsai'
                            ? ` (${aiOStrategy.charAt(0).toUpperCase() + aiOStrategy.slice(1)})`
                            : '';
                    gameStatus.innerHTML = `🎉 <span class="winner">Player O${strategy} Wins!</span> 🎉`;
                    gameEnded = true;

                } else if (game.isFull() || game.legalMoves().length === 0) {
                    gameStatus.innerHTML = `🤝 <span class="winner">It's a Tie!</span> 🤝`;
                    gameEnded = true;
                } else {
                    gameStatus.textContent = '';          // keep area blank while game is running
                }
            }
        }
        function makeMove(index) {
            if (gameMode === 'statistics') return; // No manual moves in statistics mode
            if (gameMode === 'aivsai') return; // No manual moves in AI vs AI mode
            if (gameEnded || game.board[index] !== '.' || !game.legalMoves().includes(index)) {
                return;
            }

            game.play(index, currentPlayer);
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            updateDisplay();

            // AI move for Human vs AI mode
            if (gameMode === 'ai' && currentPlayer === 'O' && !gameEnded) {
                setTimeout(() => {
                    aiDifficulty = parseInt(document.getElementById('aiDifficulty').value);
                    aiStrategy = document.getElementById('aiStrategy').value;
                    const aiMove = chooseMove(game, 'O', aiDifficulty, aiStrategy, false);
                    if (aiMove !== null) {
                        game.play(aiMove, 'O');
                        currentPlayer = 'X';
                        updateDisplay();
                    }
                }, 500);  // <-- Remove this 500ms delay!
            }
        }

        function startAiVsAi() {
            if (gameEnded) {
                resetGame();
            }
            
            aiVsAiRunning = true;
            aiVsAiPaused = false;
            
            const pauseBtn = document.getElementById('pauseBtn');
            const sharedDepthSelect = document.getElementById('sharedDepth');
            const aiXStrategySelect = document.getElementById('aiXStrategy');
            const aiOStrategySelect = document.getElementById('aiOStrategy');
            
            if (pauseBtn) pauseBtn.style.display = 'inline-block';
            
            if (sharedDepthSelect) sharedDepth = parseInt(sharedDepthSelect.value);
            if (aiXStrategySelect) aiXStrategy = aiXStrategySelect.value;
            if (aiOStrategySelect) aiOStrategy = aiOStrategySelect.value;
            
            // Reinitialize game to apply current hot blocking setting
            initGame();
            
            updateDisplay();
            runAiVsAi();
        }

        function pauseAiVsAi() {
            aiVsAiPaused = !aiVsAiPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            if (pauseBtn) {
                pauseBtn.textContent = aiVsAiPaused ? 'Resume' : 'Pause';
            }
            updateDisplay();
            
            if (!aiVsAiPaused) {
                runAiVsAi();
            }
        }

        function runAiVsAi(fastMode = false) {
            if (!aiVsAiRunning || aiVsAiPaused || gameEnded) {
                return;
            }

            const strategy = currentPlayer === 'X' ? aiXStrategy : aiOStrategy;
            const useRandomness = true; // Always use randomness in AI vs AI for variety
            const aiMove = chooseMove(game, currentPlayer, sharedDepth, strategy, useRandomness);
            
            if (aiMove !== null) {
                game.play(aiMove, currentPlayer);
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                updateDisplay();
                
                // Check if game ended
                if (game.wins('X') || game.wins('O') || game.isFull() || game.legalMoves().length === 0) {
                    aiVsAiRunning = false;
                    
                    if (fullStatsRunning) {
                        recordStatGameResult();
                    } else {
                        const pauseBtn = document.getElementById('pauseBtn');
                        if (pauseBtn) pauseBtn.style.display = 'none';
                    }
                    return;
                }
                
                // Continue with next move
                const delay = fastMode ? 50 : (fullStatsRunning ? 100 : 1500);
                setTimeout(() => {
                    runAiVsAi(fastMode);
                }, delay);
            } else {
                // No legal moves available
                aiVsAiRunning = false;
                
                if (fullStatsRunning) {
                    recordStatGameResult();
                } else {
                    const pauseBtn = document.getElementById('pauseBtn');
                    if (pauseBtn) pauseBtn.style.display = 'none';
                    updateDisplay();
                }
            }
        }

        // Full Statistics Functions
        function startFullStatistics() {
            fullStatsRunning = true;
            const gamesPerCombo = parseInt(document.getElementById('gamesPerCombo').value);
            const testDepth = parseInt(document.getElementById('testDepth').value);
            
            // Initialize full stats data
            fullStatsData.gamesPerCombo = gamesPerCombo;
            fullStatsData.testDepth = testDepth;
            fullStatsData.results = {};
            fullStatsData.currentCombo = 0;
            fullStatsData.currentGameInCombo = 0;
            
            // Calculate all combinations (each strategy vs each other strategy)
            const strategies = fullStatsData.strategies;
            fullStatsData.totalCombos = strategies.length * strategies.length;
            
            // Initialize results structure
            strategies.forEach(strategy1 => {
                fullStatsData.results[strategy1] = {};
                strategies.forEach(strategy2 => {
                    fullStatsData.results[strategy1][strategy2] = {
                        wins: 0,
                        losses: 0,
                        draws: 0,
                        games: 0
                    };
                });
            });
            
            // Show progress and hide results
            const progressDiv = document.getElementById('statisticsProgress');
            const resultsDiv = document.getElementById('fullStatisticsResults');
            const fullStatsBtn = document.getElementById('fullStatsBtn');
            const stopStatsBtn = document.getElementById('stopStatsBtn');
            
            if (progressDiv) progressDiv.style.display = 'block';
            if (resultsDiv) resultsDiv.style.display = 'none';
            if (fullStatsBtn) fullStatsBtn.style.display = 'none';
            if (stopStatsBtn) stopStatsBtn.style.display = 'inline-block';
            
            runNextStatCombo();
        }

        function stopFullStatistics() {
            fullStatsRunning = false;
            aiVsAiRunning = false;
            
            const progressDiv = document.getElementById('statisticsProgress');
            const fullStatsBtn = document.getElementById('fullStatsBtn');
            const stopStatsBtn = document.getElementById('stopStatsBtn');
            
            if (progressDiv) progressDiv.style.display = 'none';
            if (fullStatsBtn) fullStatsBtn.style.display = 'inline-block';
            if (stopStatsBtn) stopStatsBtn.style.display = 'none';
            
            // Show partial results if any data exists
            if (fullStatsData.currentCombo > 0) {
                displayFullStatistics();
            }
        }

        function runNextStatCombo() {
            if (!fullStatsRunning) return;
            
            const strategies = fullStatsData.strategies;
            const totalCombos = strategies.length * strategies.length;
            
            if (fullStatsData.currentCombo >= totalCombos) {
                // All combinations complete
                fullStatsRunning = false;
                stopFullStatistics();
                displayFullStatistics();
                return;
            }
            
            // Get current strategy combination
            const strategy1Index = Math.floor(fullStatsData.currentCombo / strategies.length);
            const strategy2Index = fullStatsData.currentCombo % strategies.length;
            const strategy1 = strategies[strategy1Index];
            const strategy2 = strategies[strategy2Index];
            
            // Update UI
            const currentTestInfo = document.getElementById('currentTestInfo');
            if (currentTestInfo) {
                currentTestInfo.textContent = `Testing: ${strategy1.charAt(0).toUpperCase() + strategy1.slice(1)} (X - goes first) vs ${strategy2.charAt(0).toUpperCase() + strategy2.slice(1)} (O - goes second)`;
            }
            
            // Set up game with these strategies
            aiXStrategy = strategy1;
            aiOStrategy = strategy2;
            sharedDepth = fullStatsData.testDepth;
            fullStatsData.currentGameInCombo = 0;
            
            runNextStatGame();
        }

        function runNextStatGame() {
            if (!fullStatsRunning) return;
            
            if (fullStatsData.currentGameInCombo >= fullStatsData.gamesPerCombo) {
                // This combination is complete, move to next
                fullStatsData.currentCombo++;
                fullStatsData.currentGameInCombo = 0; // Reset game counter
                updateStatProgress();
                setTimeout(() => runNextStatCombo(), 100);
                return;
            }
            
            // Increment the game counter before starting
            fullStatsData.currentGameInCombo++;
            
            // Start a new game with current strategies
            initGame();
            aiVsAiRunning = true;
            
            runAiVsAi(true); // Fast mode
        }

        function recordStatGameResult() {
            if (!fullStatsRunning) return;
            
            const strategies = fullStatsData.strategies;
            const strategy1Index = Math.floor(fullStatsData.currentCombo / strategies.length);
            const strategy2Index = fullStatsData.currentCombo % strategies.length;
            const strategy1 = strategies[strategy1Index];
            const strategy2 = strategies[strategy2Index];
            
            const result = fullStatsData.results[strategy1][strategy2];
            result.games++;
            
            if (game.wins('X')) {
                result.wins++;
            } else if (game.wins('O')) {
                result.losses++;
            } else {
                result.draws++;
            }
            
            // Update progress immediately after recording result
            updateStatProgress();
            
            // Continue with next game after short delay
            setTimeout(() => {
                if (fullStatsRunning) {
                    runNextStatGame();
                }
            }, 50);
        }

        function updateStatProgress() {
            const totalGames = fullStatsData.totalCombos * fullStatsData.gamesPerCombo;
            // Calculate completed games more accurately
            const completedCombos = fullStatsData.currentCombo;
            const completedGamesInCurrentCombo = Math.max(0, fullStatsData.currentGameInCombo - 1);
            const completedGames = (completedCombos * fullStatsData.gamesPerCombo) + completedGamesInCurrentCombo;
            
            // Ensure we don't exceed totals
            const safeCompletedGames = Math.min(completedGames, totalGames);
            const percentage = Math.round((safeCompletedGames / totalGames) * 100);
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            if (progressBar) progressBar.style.width = percentage + '%';
            if (progressText) progressText.textContent = `${percentage}% - ${safeCompletedGames}/${totalGames} games completed`;
        }

        function displayFullStatistics() {
            const resultsDiv = document.getElementById('fullStatisticsResults');
            if (resultsDiv) resultsDiv.style.display = 'block';
            
            displayStrategyRankings();
            displayMatchupMatrix();
            displayDetailedResults();
        }

        // Enhanced Strategy Rankings with icons, colors, and animations
        function displayStrategyRankings() {
            const strategies = fullStatsData.strategies;
            const rankings = [];
            
            strategies.forEach(strategy => {
                let totalWins = 0;
                let totalLosses = 0;
                let totalDraws = 0;
                let totalGames = 0;
                
                strategies.forEach(opponent => {
                    const result = fullStatsData.results[strategy][opponent];
                    totalWins += result.wins;
                    totalLosses += result.losses;
                    totalDraws += result.draws;
                    totalGames += result.games;
                });
                
                const winRate = totalGames > 0 ? (totalWins / totalGames) * 100 : 0;
                const lossRate = totalGames > 0 ? (totalLosses / totalGames) * 100 : 0;
                const drawRate = totalGames > 0 ? (totalDraws / totalGames) * 100 : 0;
                
                rankings.push({
                    strategy,
                    winRate,
                    lossRate,
                    drawRate,
                    totalWins,
                    totalLosses,
                    totalDraws,
                    totalGames
                });
            });
            
            rankings.sort((a, b) => b.winRate - a.winRate);
            
            // Strategy icons and colors
            const strategyInfo = {
                'pattern': { icon: '🎯', color: '#007AFF', description: 'Balanced' },
                'aggressive': { icon: '⚔️', color: '#FF3B30', description: 'Attacker' },
                'defensive': { icon: '🛡️', color: '#34C759', description: 'Defender' },
                'positional': { icon: '♟️', color: '#AF52DE', description: 'Tactician' },
                'material': { icon: '🔢', color: '#FF9500', description: 'Counter' }
            };
            
            // Medal icons for rankings
            const medals = ['🥇', '🥈', '🥉', '🏅', '🏅'];
            
            const rankingsList = document.getElementById('rankingsList');
            if (rankingsList) {
                rankingsList.innerHTML = rankings.map((rank, index) => {
                    const info = strategyInfo[rank.strategy];
                    const medal = medals[index] || '🏅';
                    const performanceClass = rank.winRate >= 60 ? 'excellent' : rank.winRate >= 50 ? 'good' : rank.winRate >= 40 ? 'average' : 'poor';
                    
                    return `
                        <div class="ranking-item enhanced ${performanceClass}" style="border-left: 4px solid ${info.color};">
                            <div class="ranking-left">
                                <span class="ranking-medal">${medal}</span>
                                <span class="ranking-position">#${index + 1}</span>
                                <div class="strategy-info">
                                    <span class="strategy-icon">${info.icon}</span>
                                    <div class="strategy-details">
                                        <span class="strategy-name" style="color: ${info.color};">${rank.strategy.charAt(0).toUpperCase() + rank.strategy.slice(1)}</span>
                                        <span class="strategy-type">${info.description}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ranking-stats-enhanced">
                                <div class="win-rate-bar">
                                    <div class="win-rate-fill" style="width: ${rank.winRate}%; background: linear-gradient(90deg, ${info.color}40, ${info.color});"></div>
                                    <span class="win-rate-text">${rank.winRate.toFixed(1)}%</span>
                                </div>
                                <div class="detailed-stats">
                                    <span class="stat-item wins">🏆 ${rank.totalWins}</span>
                                    <span class="stat-item losses">💔 ${rank.totalLosses}</span>
                                    <span class="stat-item draws">🤝 ${rank.totalDraws}</span>
                                    <span class="stat-total">📊 ${rank.totalGames} total</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function displayMatchupMatrix() {
            const strategies = fullStatsData.strategies;
            const matrixTable = document.getElementById('matrixTable');
            
            // Strategy info with enhanced icons and colors
            const strategyInfo = {
                'pattern': { icon: '🎯', color: '#007AFF', bgColor: 'rgba(0, 122, 255, 0.15)', name: 'Pattern' },
                'aggressive': { icon: '⚔️', color: '#FF3B30', bgColor: 'rgba(255, 59, 48, 0.15)', name: 'Aggressive' },
                'defensive': { icon: '🛡️', color: '#34C759', bgColor: 'rgba(52, 199, 89, 0.15)', name: 'Defensive' },
                'positional': { icon: '♟️', color: '#AF52DE', bgColor: 'rgba(175, 82, 222, 0.15)', name: 'Positional' },
                'material': { icon: '🔢', color: '#FF9500', bgColor: 'rgba(255, 149, 0, 0.15)', name: 'Material' }
            };
            
            if (matrixTable) {
                let html = '<div class="matrix-table-enhanced">';
                
                // Enhanced title section with gradient and icons
                html += '<div class="matrix-title-section">';
                html += '<div class="matrix-main-title">';
                html += '<span class="title-icon">🏆</span>';
                html += '<h3>Head-to-Head Win Rate Matrix</h3>';
                html += '<span class="title-icon">⚔️</span>';
                html += '</div>';
                html += '<div class="matrix-subtitle">';
                html += '<div class="axis-explanation-fixed">';
                html += '<div class="x-player-indicator-fixed">🔴 X Players (First Move)</div>';
                html += '<div class="vs-divider">VS</div>';
                html += '<div class="o-player-indicator-fixed">🔵 O Players (Second Move)</div>';
                html += '</div>';
                html += '<div class="reading-guide">💡 <em>Each cell shows X player\'s win rate against O player</em></div>';
                html += '</div>';
                html += '</div>';
                
                // Enhanced corner header with gradient
                html += '<div class="matrix-corner-header">';
                html += '<div class="corner-content">';
                html += '<span class="corner-x">🔴 X</span>';
                html += '<span class="corner-divider">\\</span>';
                html += '<span class="corner-o">🔵 O</span>';
                html += '</div>';
                html += '</div>';
                
                // Enhanced column headers (O players)
                strategies.forEach(strategy => {
                    const info = strategyInfo[strategy];
                    html += `<div class="matrix-header-enhanced o-player" style="background: ${info.bgColor}; border-color: ${info.color};">
                        <div class="strategy-header-content">
                            <span class="strategy-player-icon">🔵</span>
                            <span class="strategy-icon">${info.icon}</span>
                            <div class="strategy-header-text">
                                <span class="strategy-header-name" style="color: ${info.color};">${info.name}</span>
                                <span class="strategy-header-role">Second Move</span>
                            </div>
                        </div>
                    </div>`;
                });
                
                // Enhanced data rows
                strategies.forEach(strategy1 => {
                    const info1 = strategyInfo[strategy1];
                    
                    // Row header (X player)
                    html += `<div class="matrix-header-enhanced x-player" style="background: ${info1.bgColor}; border-color: ${info1.color};">
                        <div class="strategy-header-content">
                            <span class="strategy-player-icon">🔴</span>
                            <span class="strategy-icon">${info1.icon}</span>
                            <div class="strategy-header-text">
                                <span class="strategy-header-name" style="color: ${info1.color};">${info1.name}</span>
                                <span class="strategy-header-role">First Move</span>
                            </div>
                        </div>
                    </div>`;
                    
                    // Data cells - NO BACKGROUND COLORS
                    strategies.forEach(strategy2 => {
                        const result = fullStatsData.results[strategy1][strategy2];
                        const info1 = strategyInfo[strategy1];
                        const info2 = strategyInfo[strategy2];
                        
                        if (result.games === 0) {
                            html += '<div class="matrix-cell-enhanced-clean no-data"><span class="no-data-icon">⏳</span><span class="no-data-text">No Data</span></div>';
                        } else {
                            const winRate = ((result.wins / result.games) * 100).toFixed(1);
                            const winRateInt = parseInt(winRate);
                            
                            let cellClass = 'matrix-cell-enhanced-clean';
                            let performanceIcon = '';
                            let performanceText = '';
                            let cellColor = '';
                            
                            if (winRateInt >= 80) {
                                performanceIcon = '🔥';
                                performanceText = 'Dominant';
                                cellColor = '#FF6B35';
                            } else if (winRateInt >= 70) {
                                performanceIcon = '✨';
                                performanceText = 'Excellent';
                                cellColor = '#4ECDC4';
                            } else if (winRateInt >= 60) {
                                performanceIcon = '👍';
                                performanceText = 'Good';
                                cellColor = '#45B7D1';
                            } else if (winRateInt >= 40) {
                                performanceIcon = '⚖️';
                                performanceText = 'Balanced';
                                cellColor = '#FFA07A';
                            } else if (winRateInt >= 20) {
                                performanceIcon = '😔';
                                performanceText = 'Struggling';
                                cellColor = '#FF7F7F';
                            } else {
                                performanceIcon = '💔';
                                performanceText = 'Dominated';
                                cellColor = '#FF4757';
                            }
                            
                            // Special styling for mirror matches
                            if (strategy1 === strategy2) {
                                performanceIcon = '🪞';
                                performanceText = 'Mirror';
                                cellColor = '#9B59B6';
                            }
                            
                            html += `<div class="${cellClass}" 
                                style="border-left-color: ${info1.color}; border-top-color: ${info2.color};"
                                title="${performanceIcon} ${info1.name} (🔴 X) vs ${info2.name} (🔵 O): ${performanceText} - ${result.wins} wins, ${result.losses} losses, ${result.draws} draws out of ${result.games} games">
                                <div class="cell-performance">
                                    <span class="performance-indicator" style="color: ${cellColor};">${performanceIcon}</span>
                                    <span class="performance-label">${performanceText}</span>
                                </div>
                                <div class="cell-winrate">
                                    <span class="winrate-main">${winRate}%</span>
                                    <div class="winrate-bar">
                                        <div class="winrate-fill" style="width: ${winRate}%; background: linear-gradient(90deg, ${cellColor}80, ${cellColor});"></div>
                                    </div>
                                </div>
                                <div class="cell-details">
                                    <span class="wins-count">🏆${result.wins}</span>
                                    <span class="games-total">📊${result.games}</span>
                                </div>
                            </div>`;
                        }
                    });
                });
                
                html += '</div>';
                
                // Add legend
                html += '<div class="matrix-legend">';
                html += '<h4>📖 Performance Guide</h4>';
                html += '<div class="legend-items">';
                html += '<div class="legend-item"><span class="legend-icon">🔥</span><span>Dominant (80%+)</span></div>';
                html += '<div class="legend-item"><span class="legend-icon">✨</span><span>Excellent (70-79%)</span></div>';
                html += '<div class="legend-item"><span class="legend-icon">👍</span><span>Good (60-69%)</span></div>';
                html += '<div class="legend-item"><span class="legend-icon">⚖️</span><span>Balanced (40-59%)</span></div>';
                html += '<div class="legend-item"><span class="legend-icon">😔</span><span>Struggling (20-39%)</span></div>';
                html += '<div class="legend-item"><span class="legend-icon">💔</span><span>Dominated (<20%)</span></div>';
                html += '<div class="legend-item"><span class="legend-icon">🪞</span><span>Mirror Match</span></div>';
                html += '</div>';
                html += '</div>';
                
                matrixTable.innerHTML = html;
            }
        }
        // Enhanced Detailed Results with better formatting and visual elements
        function displayDetailedResults() {
            const strategies = fullStatsData.strategies;
            const detailsList = document.getElementById('detailsList');
            
            const strategyInfo = {
                'pattern': { icon: '🎯', color: '#007AFF' },
                'aggressive': { icon: '⚔️', color: '#FF3B30' },
                'defensive': { icon: '🛡️', color: '#34C759' },
                'positional': { icon: '♟️', color: '#AF52DE' },
                'material': { icon: '🔢', color: '#FF9500' }
            };
            
            if (detailsList) {
                let html = '<div class="detail-header-enhanced">';
                html += '<div class="detail-col-matchup"><span>🥊</span><span>Matchup Details</span></div>';
                html += '<div class="detail-col-stat"><span>🏆</span><span>Wins</span></div>';
                html += '<div class="detail-col-stat"><span>💔</span><span>Losses</span></div>';
                html += '<div class="detail-col-stat"><span>🤝</span><span>Draws</span></div>';
                html += '<div class="detail-col-stat"><span>📈</span><span>Win Rate</span></div>';
                html += '</div>';
                
                // Group by X strategy for better organization
                strategies.forEach(strategy1 => {
                    const info1 = strategyInfo[strategy1];
                    
                    // Add strategy section header
                    html += `<div class="strategy-section-header" style="border-left: 4px solid ${info1.color};">
                        <span class="section-icon">${info1.icon}</span>
                        <strong>${strategy1.charAt(0).toUpperCase() + strategy1.slice(1)} as X Player (First Move)</strong>
                    </div>`;
                    
                    strategies.forEach(strategy2 => {
                        const result = fullStatsData.results[strategy1][strategy2];
                        if (result.games > 0) {
                            const info2 = strategyInfo[strategy2];
                            const winRate = ((result.wins / result.games) * 100).toFixed(1);
                            const winRateNum = parseFloat(winRate);
                            
                            let performanceClass = 'performance-neutral';
                            let performanceIcon = '➖';
                            if (winRateNum >= 70) { performanceClass = 'performance-excellent'; performanceIcon = '🔥'; }
                            else if (winRateNum >= 60) { performanceClass = 'performance-good'; performanceIcon = '✨'; }
                            else if (winRateNum >= 40) { performanceClass = 'performance-average'; performanceIcon = '⚖️'; }
                            else { performanceClass = 'performance-poor'; performanceIcon = '❄️'; }
                            
                            html += `<div class="detail-item-enhanced ${performanceClass}">`;
                            html += `<div class="detail-col-matchup">
                                <div class="matchup-visual">
                                    <span class="player-x" style="color: ${info1.color};">${info1.icon} ${strategy1.charAt(0).toUpperCase() + strategy1.slice(1)}</span>
                                    <span class="vs-text">vs</span>
                                    <span class="player-o" style="color: ${info2.color};">${info2.icon} ${strategy2.charAt(0).toUpperCase() + strategy2.slice(1)}</span>
                                </div>
                            </div>`;
                            html += `<div class="detail-col-stat stat-wins">${result.wins}</div>`;
                            html += `<div class="detail-col-stat stat-losses">${result.losses}</div>`;
                            html += `<div class="detail-col-stat stat-draws">${result.draws}</div>`;
                            html += `<div class="detail-col-stat stat-winrate">
                                <span class="performance-icon">${performanceIcon}</span>
                                <span class="winrate-value">${winRate}%</span>
                                <div class="mini-bar">
                                    <div class="mini-bar-fill" style="width: ${winRate}%;"></div>
                                </div>
                            </div>`;
                            html += '</div>';
                        }
                    });
                });
                
                detailsList.innerHTML = html;
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const hotBlockingToggle = document.getElementById('hotBlocking');
            if (hotBlockingToggle) {
                hotBlockingToggle.addEventListener('change', resetGame);
            }
            
            const aiHotBlockingToggle = document.getElementById('aiHotBlocking');
            if (aiHotBlockingToggle) {
                aiHotBlockingToggle.addEventListener('change', resetGame);
            }
            
            const aiVsAiHotBlockingToggle = document.getElementById('aiVsAiHotBlocking');
            if (aiVsAiHotBlockingToggle) {
                aiVsAiHotBlockingToggle.addEventListener('change', resetGame);
            }
            
            const statsHotBlockingToggle = document.getElementById('statsHotBlocking');
            if (statsHotBlockingToggle) {
                statsHotBlockingToggle.addEventListener('change', function() {
                    // No need to reset game in statistics mode
                });
            }
            
            const aiDifficultySelect = document.getElementById('aiDifficulty');
            if (aiDifficultySelect) {
                aiDifficultySelect.addEventListener('change', function() {
                    aiDifficulty = parseInt(this.value);
                });
            }
            
            const aiStrategySelect = document.getElementById('aiStrategy');
            if (aiStrategySelect) {
                aiStrategySelect.addEventListener('change', function() {
                    aiStrategy = this.value;
                });
            }
            
            const sharedDepthSelect = document.getElementById('sharedDepth');
            if (sharedDepthSelect) {
                sharedDepthSelect.addEventListener('change', function() {
                    sharedDepth = parseInt(this.value);
                });
            }
            
            const aiXStrategySelect = document.getElementById('aiXStrategy');
            if (aiXStrategySelect) {
                aiXStrategySelect.addEventListener('change', function() {
                    aiXStrategy = this.value;
                    updateStrategyDescription('aiXStrategy', 'aiXDescription');
                });
            }
            
            const aiOStrategySelect = document.getElementById('aiOStrategy');
            if (aiOStrategySelect) {
                aiOStrategySelect.addEventListener('change', function() {
                    aiOStrategy = this.value;
                    updateStrategyDescription('aiOStrategy', 'aiODescription');
                });
            }
            const hotBlockingLabel = document.getElementById('hotBlockingLabel');
            if (hotBlockingLabel){ hotBlockingLabel.style.display = 'inline-block'; }   // ברירת-מחדל: human

        // Enhanced Interactive Features
        document.addEventListener('DOMContentLoaded', function() {
            
            // Add smooth entrance animation to game container
            const gameContainer = document.querySelector('.game-container');
            if (gameContainer) {
                gameContainer.style.opacity = '0';
                gameContainer.style.transform = 'translateY(50px) scale(0.95)';
                
                setTimeout(() => {
                    gameContainer.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                    gameContainer.style.opacity = '1';
                    gameContainer.style.transform = 'translateY(0) scale(1)';
                }, 100);
            }
            
            // Add hover sound effects (visual feedback)
            function addHoverEffects() {
                const cells = document.querySelectorAll('.cell');
                cells.forEach(cell => {
                    cell.addEventListener('mouseenter', function() {
                        if (!this.classList.contains('blocked') && this.textContent === '') {
                            this.style.transform = 'translateY(-4px) scale(1.02)';
                            this.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                        }
                    });
                    
                    cell.addEventListener('mouseleave', function() {
                        if (!this.classList.contains('blocked')) {
                            this.style.transform = 'translateY(0) scale(1)';
                        }
                    });
                });
            }
            
            // Add ripple effect to buttons
            function addRippleEffect(button) {
                button.addEventListener('click', function(e) {
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.classList.add('ripple');
                    
                    ripple.style.position = 'absolute';
                    ripple.style.borderRadius = '50%';
                    ripple.style.background = 'rgba(255, 255, 255, 0.6)';
                    ripple.style.transform = 'scale(0)';
                    ripple.style.animation = 'ripple 0.6s linear';
                    ripple.style.pointerEvents = 'none';
                    
                    this.appendChild(ripple);
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            }
            
            // Add ripple CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
                
                .cell-highlight {
                    animation: cellHighlight 0.6s ease-out;
                }
                
                @keyframes cellHighlight {
                    0% { 
                        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
                        transform: scale(1);
                    }
                    70% { 
                        box-shadow: 0 0 0 10px rgba(102, 126, 234, 0);
                        transform: scale(1.05);
                    }
                    100% { 
                        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
                        transform: scale(1);
                    }
                }
                
                .mode-transition {
                    animation: modeTransition 0.5s ease-out;
                }
                
                @keyframes modeTransition {
                    0% { opacity: 0; transform: translateY(20px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                
                .winner-fireworks {
                    position: relative;
                    overflow: visible;
                }
                
                .firework {
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    border-radius: 50%;
                    animation: firework 1s ease-out forwards;
                }
                
                @keyframes firework {
                    0% {
                        opacity: 1;
                        transform: scale(0);
                    }
                    50% {
                        opacity: 1;
                        transform: scale(1);
                    }
                    100% {
                        opacity: 0;
                        transform: scale(1) translate(var(--dx), var(--dy));
                    }
                }
                
                .floating-symbol {
                    position: absolute;
                    pointer-events: none;
                    font-size: 2rem;
                    font-weight: bold;
                    opacity: 0;
                    animation: floatUp 2s ease-out forwards;
                }
                
                @keyframes floatUp {
                    0% {
                        opacity: 1;
                        transform: translateY(0) scale(1);
                    }
                    100% {
                        opacity: 0;
                        transform: translateY(-100px) scale(0.5);
                    }
                }
                
                @keyframes thinkingPulse {
                    0%, 100% { opacity: 0.3; }
                    50% { opacity: 1; }
                }
                
                .thinking-dots {
                    margin-left: 5px;
                    font-weight: bold;
                }
            `;
            document.head.appendChild(style);
            
            // Apply ripple effect to all buttons
            const buttons = document.querySelectorAll('.reset-btn, .stats-btn, .mode-btn, .primary-button');
            buttons.forEach(addRippleEffect);
            
            // Enhanced cell click animation
            function enhancedCellClick(cell, player) {
                // Add highlight animation
                cell.classList.add('cell-highlight');
                
                // Create floating symbol effect
                const floatingSymbol = document.createElement('div');
                floatingSymbol.textContent = player;
                floatingSymbol.className = `floating-symbol ${player}`;
                floatingSymbol.style.left = '50%';
                floatingSymbol.style.top = '50%';
                floatingSymbol.style.transform = 'translate(-50%, -50%)';
                floatingSymbol.style.zIndex = '1000';
                
                cell.appendChild(floatingSymbol);
                
                setTimeout(() => {
                    cell.classList.remove('cell-highlight');
                    floatingSymbol.remove();
                }, 2000);
            }
            
            // Fireworks effect for winner
            function createFireworks(element) {
                element.classList.add('winner-fireworks');
                
                const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];
                
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const firework = document.createElement('div');
                        firework.className = 'firework';
                        firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                        firework.style.left = '50%';
                        firework.style.top = '50%';
                        
                        const angle = (Math.PI * 2 * i) / 20;
                        const distance = 100 + Math.random() * 50;
                        const dx = Math.cos(angle) * distance;
                        const dy = Math.sin(angle) * distance;
                        
                        firework.style.setProperty('--dx', dx + 'px');
                        firework.style.setProperty('--dy', dy + 'px');
                        
                        element.appendChild(firework);
                        
                        setTimeout(() => {
                            firework.remove();
                        }, 1000);
                    }, i * 50);
                }
            }
            
            // Smooth mode transitions
            function smoothModeTransition(targetElement) {
                targetElement.style.opacity = '0';
                targetElement.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    targetElement.style.transition = 'all 0.5s ease-out';
                    targetElement.style.opacity = '1';
                    targetElement.style.transform = 'translateY(0)';
                    targetElement.classList.add('mode-transition');
                }, 100);
            }
            
            // Enhanced board update with animations
            const originalUpdateDisplay = window.updateDisplay;
            window.updateDisplay = function() {
                if (typeof originalUpdateDisplay === 'function') {
                    originalUpdateDisplay();
                }
                
                // Re-add hover effects after board update
                addHoverEffects();
                
                // Check for winner and add fireworks
                const gameStatus = document.getElementById('gameStatus');
                if (gameStatus && gameStatus.innerHTML.includes('Wins!')) {
                    setTimeout(() => {
                        createFireworks(gameStatus);
                    }, 500);
                }
            };
            
            // Enhanced make move with animation
            const originalMakeMove = window.makeMove;
            window.makeMove = function(index) {
                const cell = document.querySelectorAll('.cell')[index];
                const currentPlayer = window.currentPlayer;
                
                if (typeof originalMakeMove === 'function') {
                    const result = originalMakeMove(index);
                    
                    // Add enhanced animation if move was successful
                    if (cell && cell.textContent && cell.textContent !== '') {
                        enhancedCellClick(cell, currentPlayer);
                    }
                    
                    return result;
                }
            };
            
            // Smooth page transitions
            function addPageTransitions() {
                const aiSettings = document.getElementById('aiSettings');
                const gameControls = document.getElementById('gameControls');
                const statisticsSettings = document.getElementById('statisticsSettings');
                
                // Override setGameMode for smooth transitions
                const originalSetGameMode = window.setGameMode;
                window.setGameMode = function(mode) {
                    // Fade out current content
                    const activeElements = [aiSettings, gameControls, statisticsSettings].filter(el => 
                        el && (el.classList.contains('show') || el.style.display !== 'none')
                    );
                    
                    activeElements.forEach(el => {
                        el.style.transition = 'opacity 0.3s ease-out';
                        el.style.opacity = '0';
                    });
                    
                    setTimeout(() => {
                        if (typeof originalSetGameMode === 'function') {
                            originalSetGameMode(mode);
                        }
                        
                        // Fade in new content
                        setTimeout(() => {
                            const newActiveElements = [aiSettings, gameControls, statisticsSettings].filter(el => 
                                el && (el.classList.contains('show') || el.style.display !== 'none')
                            );
                            
                            newActiveElements.forEach(el => {
                                smoothModeTransition(el);
                            });
                        }, 100);
                    }, 300);
                };
            }
            
            // Parallax effect for background
            // function addParallaxEffect() {
            //     let mouseX = 0;
            //     let mouseY = 0;
                
            //     document.addEventListener('mousemove', (e) => {
            //         mouseX = (e.clientX / window.innerWidth) * 100;
            //         mouseY = (e.clientY / window.innerHeight) * 100;
                    
            //         const container = document.querySelector('.game-container');
            //         if (container) {
            //             const moveX = (mouseX - 50) * 0.02;
            //             const moveY = (mouseY - 50) * 0.02;
                        
            //             container.style.transform = `translateY(0) scale(1) rotateX(${moveY}deg) rotateY(${moveX}deg)`;
            //             container.style.transformStyle = 'preserve-3d';
            //             container.style.perspective = '1000px';
            //         }
            //     });
                
            //     document.addEventListener('mouseleave', () => {
            //         const container = document.querySelector('.game-container');
            //         if (container) {
            //             container.style.transform = 'translateY(0) scale(1) rotateX(0deg) rotateY(0deg)';
            //         }
            //     });
            // }
            
            // Add loading animation for AI moves
            function addAIThinkingAnimation() {
                const originalRunAiVsAi = window.runAiVsAi;
                
                window.runAiVsAi = function(fastMode) {
                    if (!fastMode) {
                        const currentPlayerDiv = document.getElementById('currentPlayer');
                        if (currentPlayerDiv && currentPlayerDiv.innerHTML.includes('Thinking')) {
                            // Add thinking animation
                            const dots = document.createElement('span');
                            dots.innerHTML = '<span class="thinking-dots">...</span>';
                            dots.style.animation = 'thinkingPulse 1.5s ease-in-out infinite';
                            currentPlayerDiv.appendChild(dots);
                        }
                    }
                    
                    if (typeof originalRunAiVsAi === 'function') {
                        return originalRunAiVsAi(fastMode);
                    }
                };
            }
            
            // Initialize all enhancements
            addHoverEffects();
            addPageTransitions();
            // addParallaxEffect();
            addAIThinkingAnimation();
            
            // Add smooth scroll for long content
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Add focus animations for form elements
            const formElements = document.querySelectorAll('select, input');
            formElements.forEach(element => {
                element.addEventListener('focus', function() {
                    this.style.transform = 'translateY(-2px) scale(1.02)';
                });
                
                element.addEventListener('blur', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
            
            console.log('🎮 Enhanced game interface loaded with premium animations!');
        });
            // Initialize strategy descriptions
            updateStrategyDescription('aiXStrategy', 'aiXDescription');
            updateStrategyDescription('aiOStrategy', 'aiODescription');

            // Initialize game
            initGame();
        });
    </script>
</body>
</html>
